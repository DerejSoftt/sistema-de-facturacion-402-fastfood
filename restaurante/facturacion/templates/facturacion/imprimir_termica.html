<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Factura T√©rmica - {{ factura.numero_factura }}</title>
    <style>
        @media print {
            body {
                width: 70mm;
                margin-left: 15px;
                font-family: 'Courier New', monospace;
                font-size: 12px;
                padding: 5px;
            }
            .header { text-align: center; margin-bottom: 5px; font-size: 17px;}
            .info { margin: 0px 0;  font-size: 17px;}
            .info-row { display: flex; justify-content: space-between; }
            .items { width: 100%; margin: 10px 0; }
            .items th { text-align: left; border-bottom: 1px dashed #000; }
            .items td { padding: 2px 0; }
            .item-name { width: 50%; font-size: 17px;}
            .item-qty { width: 15%; text-align: center; font-size: 17px;}
            .item-price { width: 20%; text-align: right; font-size: 17px;}
            .item-total { width: 15%; text-align: right; font-size: 17px;}
            .totals { margin-top: 10px; }
            .total-row { display: flex; justify-content: space-between; font-size: 17px;}
            .footer { text-align: center; margin-top: 15px; font-size: 14px; }
            hr { border: none; border-top: 1px dashed #000; }
        }
        @page {
            size: 80mm auto;
            margin: 0;
        }
        /* Estilos para pantalla (no impresi√≥n) */
        .no-print {
            text-align: center;
            margin-top: 20px;
            padding: 20px;
            background: #f5f5f5;
            border-radius: 5px;
        }
        .boton-volver {
            display: inline-block;
            padding: 10px 20px;
            background: #4CAF50;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            font-weight: bold;
            margin: 10px;
        }
        .boton-imprimir {
            display: inline-block;
            padding: 10px 20px;
            background: #2196F3;
            color: white;
            border: none;
            border-radius: 5px;
            font-weight: bold;
            margin: 10px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="header">
        <h2>{{ empresa.nombre }}</h2>
        <p>{{ empresa.direccion }}</p>
        <p>Tel: {{ empresa.telefono }}</p>
        <p>RUC: {{ empresa.ruc }}</p>
        <hr>
    </div>
    
    <div class="info">
        <div class="info-row">
            <span>FACTURA:</span>
            <span>{{ factura.numero_factura }}</span>
        </div>
        <div class="info-row">
            <span>FECHA:</span>
            <span>{{ factura.fecha_factura|date:"d/m/Y H:i" }}</span>
        </div>
        <div class="info-row">
            <span>PEDIDO:</span>
            <span>
                {% if factura.pedido and factura.pedido.codigo_pedido %}
                    {{ factura.pedido.codigo_pedido }}
                {% else %}
                    N/A
                {% endif %}
            </span>
        </div>
        <div class="info-row">
            <span>TIPO:</span>
            <span>
                {% if factura.tipo_pedido == 'mesa' %}
                    MESA
                {% elif factura.tipo_pedido == 'delivery' %}
                    DELIVERY
                {% elif factura.tipo_pedido == 'llevar' %}
                    PARA LLEVAR
                {% else %}
                    {{ factura.tipo_pedido }}
                {% endif %}
            </span>
        </div>
        {% if factura.numero_mesa_codigo %}
        <div class="info-row">
            <span>
                {% if factura.tipo_pedido == 'mesa' %}MESA:
                {% elif factura.tipo_pedido == 'delivery' %}C√ìDIGO:
                {% elif factura.tipo_pedido == 'llevar' %}C√ìDIGO:
                {% else %}REF:
                {% endif %}
            </span>
            <span>{{ factura.numero_mesa_codigo }}</span>
        </div>
        {% endif %}
        <div class="info-row">
            <span>ESTADO:</span>
            <span>{{ factura.estado|upper }}</span>
        </div>
        <div class="info-row">
            <span>PAGO:</span>
            <span>
                {% if factura.metodo_pago == 'efectivo' %}EFECTIVO
                {% elif factura.metodo_pago == 'tarjeta' %}TARJETA
                {% elif factura.metodo_pago == 'transferencia' %}TRANSFERENCIA
                {% else %}{{ factura.metodo_pago|upper }}
                {% endif %}
            </span>
        </div>
        <hr>
    </div>
    
    {% if factura.nombre_cliente %}
    <div class="info">
        <div class="info-row">
            <span>CLIENTE:</span>
            <span>{{ factura.nombre_cliente }}</span>
        </div>
        {% if factura.telefono_cliente %}
        <div class="info-row">
            <span>TEL√âFONO:</span>
            <span>{{ factura.telefono_cliente }}</span>
        </div>
        {% endif %}
        {% if factura.direccion_entrega %}
        <div class="info-row">
            <span>DIRECCI√ìN:</span>
            <span>{{ factura.direccion_entrega }}</span>
        </div>
        {% endif %}
        <hr>
    </div>
    {% endif %}
    
    <table class="items">
        <thead>
            <tr>
                <th class="item-name">DESCRIPCI√ìN</th>
                <th class="item-qty">CANT</th>
                <th class="item-price">PRECIO</th>
                <th class="item-total">TOTAL</th>
            </tr>
        </thead>
        <tbody>
            {% for item in items %}
            <tr>
                <td class="item-name">{{ item.name|truncatechars:20 }}</td>
                <td class="item-qty">{{ item.quantity }}</td>
                <td class="item-price">${{ item.price|floatformat:2 }}</td>
                <td class="item-total">${{ item.total|floatformat:2 }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    
    <div class="totals">
        <hr>
        <div class="total-row">
            <span>Subtotal:</span>
            <span>${{ factura.subtotal|floatformat:2 }}</span>
        </div>
        <!-- Mostrar IVA si es mayor a 0 -->
        {% if factura.iva > 0 %}
        <!-- <div class="total-row">
            <span>IVA 12%:</span>
            <span>${{ factura.iva|floatformat:2 }}</span>
        </div> -->
        {% endif %}
        {% if factura.envio > 0 %}
        <div class="total-row">
            <span>Env√≠o:</span>
            <span>${{ factura.envio|floatformat:2 }}</span>
        </div>
        {% endif %}
        <div class="total-row" style="font-weight: bold; margin-top: 5px; padding-top: 5px; border-top: 2px solid #000;">
            <span>TOTAL:</span>
            <span>${{ factura.subtotal|floatformat:2 }}</span>
        </div>
    </div>
    
    <div class="footer">
        <hr>
        <p>¬°GRACIAS POR SU VISITA!</p>
        {% if factura.notas %}
        <p>NOTAS: {{ factura.notas|truncatechars:60 }}</p>
        {% endif %}
        <hr>
        <p>Factura generada electr√≥nicamente</p>
        <p>No v√°lida como comprobante de cr√©dito fiscal</p>
        {% if factura.creado_por %}
        <p>Atendido por: {{ factura.creado_por.get_full_name|default:factura.creado_por.username }}</p>
        {% endif %}
    </div>
    
    <!-- Controles para pantalla (no se imprimen) -->
    <div class="no-print" style="text-align: center; margin-top: 30px;">
        <a href="{% url 'facturacion' %}?de_impresion=true" class="boton-volver">
            ‚úÖ Volver a Facturaci√≥n
        </a>
        <button onclick="window.print()" class="boton-imprimir">
            üñ®Ô∏è Imprimir Factura
        </button>
    </div>
    
    <script>
        // Imprimir autom√°ticamente al cargar (solo en modo impresi√≥n)
        window.onload = function() {
            // Verificar si estamos en una vista previa de impresi√≥n
            if (window.location.search.indexOf('noprint') === -1) {
                setTimeout(function() {
                    window.print();
                }, 500);
            }
        };
        
        // Redirigir despu√©s de imprimir si el usuario lo desea
        window.onafterprint = function() {
            console.log('Impresi√≥n completada');
            // Mostrar opci√≥n para volver
            document.querySelector('.no-print').style.display = 'block';
        };
    </script>
</body>
</html>