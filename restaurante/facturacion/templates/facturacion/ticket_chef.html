<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Ticket Chef - {{ codigo_pedido }}</title>
    <style>
        /* ESTILOS PARA AKOIA 3850 CON TEXTO 15px */
        * {
            margin: 0 !important;
            padding: 0 !important;
            box-sizing: border-box !important;
            font-family: 'Courier New', Courier, monospace !important;
            font-weight: bold !important;
        }
        
        html, body {
            width: 80mm !important;
            max-width: 80mm !important;
            min-height: 0 !important;
            margin: 0 auto !important;
            padding: 0 !important;
            font-size: 15px !important; /* TEXTO EN 15px COMO SOLICITADO */
            line-height: 1 !important; /* SIN ESPACIADO */
            background: white !important;
            -webkit-print-color-adjust: exact !important;
            print-color-adjust: exact !important;
            overflow: hidden !important;
        }
        
        @page {
            size: 80mm auto;
            margin: 0mm !important;
            padding: 0mm !important;
        }
        
        .ticket {
            width: 78mm !important;
            max-width: 78mm !important;
            margin: 0 auto !important;
            padding: 0 !important;
        }
        
        /* ENCABEZADO CON TEXTO 15px */
        .header {
            text-align: center;
            margin: 0 0 0.5mm 0 !important;
            padding: 0 !important;
        }
        
        .restaurant-name {
            font-size: 17px !important; /* Un poco m√°s grande para destacar */
            font-weight: 900 !important;
            margin: 0 0 0.3mm 0 !important;
            padding: 0 !important;
            text-transform: uppercase;
        }
        
        .ticket-title {
            font-size: 16px !important; /* Cercano a 15px */
            font-weight: 900 !important;
            margin: 0 0 0.3mm 0 !important;
            padding: 0 !important;
        }
        
        .ticket-info {
            font-size: 14px !important; /* Cercano a 15px */
            margin: 0 0 0.3mm 0 !important;
            padding: 0 !important;
        }
        
        .pedido-code {
            font-size: 16px !important; /* Destacado */
            font-weight: 900 !important;
            margin: 0.5mm 0 !important;
            padding: 0.5mm 0 !important;
            background: #000 !important;
            color: white !important;
            text-transform: uppercase;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        
        .cliente-code {
            font-size: 15px !important; /* Igual a 15px */
            font-weight: 900 !important;
            margin: 0.5mm 0 !important;
            padding: 0.5mm 0 !important;
            background: #f0f0f0 !important;
            color: #000 !important;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        
        /* SEPARADORES DELGADOS */
        .separator {
            border-top: 0.5px dashed #000 !important;
            margin: 0.3mm 0 !important;
            height: 0;
        }
        
        .double-separator {
            border-top: 1px solid #000 !important;
            margin: 0.5mm 0 !important;
            height: 0;
        }
        
        /* ITEMS CON TEXTO 15px */
        .section-title {
            font-weight: 900 !important;
            font-size: 16px !important; /* Un poco m√°s para destacar secciones */
            margin: 0.3mm 0 0.2mm 0 !important;
            padding: 0.2mm 0 !important;
            text-transform: uppercase;
            background: #f8f8f8 !important;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        
        .items-container {
            margin: 0 !important;
            padding: 0 !important;
        }
        
        .item-row {
            display: flex;
            margin: 0 !important;
            padding: 0 !important;
            font-size: 15px !important; /* TEXTO EN 15px */
            height: auto !important;
            min-height: 0 !important;
            line-height: 1 !important;
        }
        
        .item-qty {
            width: 8mm !important; /* Un poco m√°s ancho para 15px */
            text-align: left;
            font-weight: 900 !important;
            white-space: nowrap;
        }
        
        .item-name {
            flex: 1;
            font-weight: 900 !important;
            font-size: 15px !important; /* TEXTO EN 15px */
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
            padding: 0 1mm !important;
        }
        
        .item-code {
            width: 12mm !important; /* Un poco m√°s ancho para 15px */
            text-align: right;
            font-weight: 900 !important;
            white-space: nowrap;
        }
        
        /* PIE DE P√ÅGINA CON TEXTO 15px */
        .footer {
            text-align: center;
            margin: 0.5mm 0 0 0 !important;
            padding: 0 !important;
            font-size: 14px !important; /* Cercano a 15px */
        }
        
        .total-info {
            font-weight: 900 !important;
            margin: 0.3mm 0 !important;
            padding: 0.3mm 0 !important;
            background: #f0f0f0 !important;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        
        .footer-mensaje {
            font-weight: 900 !important;
            font-size: 15px !important; /* TEXTO EN 15px */
            margin: 0.3mm 0 !important;
            padding: 0 !important;
        }
        
        .stars {
            letter-spacing: 0.5px;
            color: #000;
            font-size: 15px !important; /* TEXTO EN 15px */
            margin: 0.3mm 0 !important;
            padding: 0 !important;
        }
        
        /* IMPRESI√ìN - CONFIGURACI√ìN ESPEC√çFICA PARA AKOIA CON 15px */
        @media print {
            html, body {
                width: 80mm !important;
                height: auto !important;
                margin: 0 !important;
                padding: 0 !important;
                font-size: 15px !important; /* MANTENER 15px AL IMPRIMIR */
                line-height: 0.95 !important; /* COMPACTO */
            }
            
            body * {
                line-height: 0.95 !important;
                max-height: none !important;
                float: none !important;
            }
            
            .ticket {
                width: 80mm !important;
                margin: 0 !important;
                padding: 0 !important;
                transform: scale(0.96) !important; /* Un poco m√°s de escalado para 15px */
                transform-origin: top left !important;
            }
            
            .no-print {
                display: none !important;
            }
            
            /* COMPRIMIR AL M√ÅXIMO EN IMPRESI√ìN */
            .header {
                margin-bottom: 0.2mm !important;
            }
            
            .restaurant-name {
                font-size: 16px !important;
            }
            
            .item-row {
                font-size: 14px !important; /* Reducir un poco al imprimir para ajuste */
                margin: 0.1mm 0 !important;
            }
            
            .item-name {
                font-size: 15px !important;
            }
            
            .pedido-code, .cliente-code {
                padding: 0.3mm 0 !important;
                margin: 0.3mm 0 !important;
            }
            
            .separator, .double-separator {
                margin: 0.2mm 0 !important;
            }
            
            .footer {
                margin-top: 0.2mm !important;
            }
            
            /* FORZAR SALTO DE P√ÅGINA EVITADO */
            .ticket {
                page-break-inside: avoid !important;
                break-inside: avoid !important;
            }
        }
        
        /* BOTONES M√ÅS GRANDES COMO SOLICITADO */
        .no-print {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 1000;
            background: white;
            padding: 10px;
            border: 2px solid #000;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            font-size: 16px;
        }
        
        .btn-print, .btn-close {
            padding: 12px 24px !important; /* BOTONES M√ÅS GRANDES */
            border: 2px solid #000 !important;
            cursor: pointer;
            margin-left: 10px !important;
            font-size: 16px !important; /* TEXTO M√ÅS GRANDE EN BOTONES */
            font-weight: bold !important;
            border-radius: 6px !important;
            transition: all 0.3s ease !important;
            min-width: 120px !important; /* ANCHO M√çNIMO */
        }
        
        .btn-print {
            background: #4CAF50 !important;
            color: white !important;
        }
        
        .btn-print:hover {
            background: #45a049 !important;
            transform: translateY(-2px) !important;
        }
        
        .btn-close {
            background: #f44336 !important;
            color: white !important;
        }
        
        .btn-close:hover {
            background: #d32f2f !important;
            transform: translateY(-2px) !important;
        }
        
        /* Para pantallas peque√±as, ajustar botones */
        @media (max-width: 600px) {
            .no-print {
                top: 5px;
                right: 5px;
                padding: 8px;
            }
            
            .btn-print, .btn-close {
                padding: 10px 20px !important;
                font-size: 14px !important;
                min-width: 100px !important;
                margin-left: 5px !important;
            }
        }
    </style>
</head>
<body>
    <!-- BOTONES M√ÅS GRANDES Y VISIBLES -->
    <div class="no-print">
        <button class="btn-print" onclick="window.print()">üñ®Ô∏è IMPRIMIR TICKET</button>
        <button class="btn-close" onclick="window.close()">‚ùå CERRAR VENTANA</button>
    </div>
    
    <div class="ticket">
        <!-- ENCABEZADO CON TEXTO 15px -->
        <div class="header">
            <div class="restaurant-name">402 FASTFOOD</div>
            <div class="ticket-title">TICKET COCINA</div>
            <div class="ticket-info">{{ fecha }}</div>
            
            <div class="pedido-code">
                PEDIDO: {{ codigo_pedido|default:"N/A" }}
            </div>
            
            <div class="cliente-code">
                {% if pedido.tipo_pedido == 'mesa' and pedido.mesa %}
                    MESA: {{ pedido.mesa.numero_display }}
                {% elif pedido.tipo_pedido == 'delivery' %}
                    DELIVERY: {{ pedido.codigo_delivery }}
                {% elif pedido.tipo_pedido == 'llevar' %}
                    PARA LLEVAR: {{ pedido.codigo_delivery }}
                {% endif %}
            </div>
            
            <div class="ticket-info">
                Tipo: {{ pedido.get_tipo_pedido_display|upper }}
            </div>
        </div>
        
        <div class="separator"></div>
        
        <!-- PLATOS CON TEXTO 15px -->
        {% if platos_items %}
        <div class="section-title">PLATOS</div>
        <div class="items-container">
            {% for item in platos_items %}
            <div class="item-row">
                <div class="item-qty">{{ item.quantity }}x</div>
                <div class="item-name">{{ item.name|truncatechars:25 }}</div>
                <div class="item-code">{{ item.codigo|default:"---" }}</div>
            </div>
            {% endfor %}
        </div>
        {% endif %}
        
        <!-- BEBIDAS CON TEXTO 15px -->
        {% if bebidas_items %}
        <div class="separator"></div>
        <div class="section-title">BEBIDAS</div>
        <div class="items-container">
            {% for item in bebidas_items %}
            <div class="item-row">
                <div class="item-qty">{{ item.quantity }}x</div>
                <div class="item-name">{{ item.name|truncatechars:25 }}</div>
                <div class="item-code">{{ item.codigo|default:"---" }}</div>
            </div>
            {% endfor %}
        </div>
        {% endif %}
        
        <div class="double-separator"></div>
        
        <!-- PIE DE P√ÅGINA CON TEXTO 15px -->
        <div class="footer">
            <div class="total-info">
                TOTAL ITEMS: {{ total_items }}
            </div>
            <div class="ticket-info">Hora: {{ pedido.fecha_pedido|time:"H:i" }}</div>
            <div class="stars">‚ú¶‚ú¶‚ú¶‚ú¶‚ú¶‚ú¶‚ú¶‚ú¶‚ú¶‚ú¶‚ú¶‚ú¶</div>
            <div class="footer-mensaje">¬°PREPARAR CON AMOR!</div>
        </div>
    </div>
    
    <script>
        // AJUSTE DIN√ÅMICO PARA TEXTO 15px
        document.addEventListener('DOMContentLoaded', function() {
            // Calcular si necesitamos ajustar por muchos items
            const platosCount = {{ platos_items|length|default:0 }};
            const bebidasCount = {{ bebidas_items|length|default:0 }};
            const totalItems = platosCount + bebidasCount;
            
            console.log(`Items totales: ${totalItems}`);
            
            // Si hay muchos items, ajustar truncado
            if (totalItems > 15) {
                // Reducir truncado para m√°s items
                document.querySelectorAll('.item-name').forEach(name => {
                    name.style.maxWidth = '40mm';
                });
            }
            
            // Ajuste espec√≠fico para Aokia 3850 con texto 15px
            const isAokia = true;
            if (isAokia) {
                // Ajustar para mejor impresi√≥n con texto 15px
                document.querySelectorAll('.item-row').forEach(row => {
                    row.style.lineHeight = '0.9';
                });
                
                // Asegurar que no haya desbordamiento
                document.querySelectorAll('.item-name').forEach(name => {
                    name.style.overflow = 'hidden';
                    name.style.textOverflow = 'ellipsis';
                });
            }
            
            // Imprimir autom√°ticamente con retardo
            setTimeout(function() {
                window.print();
            }, 800);
        });
        
        // Cerrar despu√©s de imprimir
        window.onafterprint = function() {
            setTimeout(function() {
                window.close();
            }, 2000);
        };
        
        // Cerrar con ESC
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') window.close();
        });
        
        // Ajustes previos a la impresi√≥n para texto 15px
        window.addEventListener('beforeprint', function() {
            // Optimizaciones para impresi√≥n con texto grande
            document.body.style.lineHeight = '0.92';
            
            // Asegurar que todo el contenido est√© visible
            document.querySelectorAll('*').forEach(el => {
                el.style.maxHeight = 'none';
                el.style.overflow = 'visible';
            });
        });
        
        // Bot√≥n adicional para vista previa (solo en pantalla)
        document.addEventListener('DOMContentLoaded', function() {
            // Agregar bot√≥n de vista previa si estamos en pantalla
            if (!window.matchMedia('print').matches) {
                const noPrintDiv = document.querySelector('.no-print');
                const previewBtn = document.createElement('button');
                previewBtn.className = 'btn-print';
                previewBtn.innerHTML = 'üëÅÔ∏è VISTA PREVIA';
                previewBtn.style.backgroundColor = '#2196F3';
                previewBtn.style.marginLeft = '10px';
                previewBtn.onclick = function() {
                    // Mostrar mensaje de ayuda
                    alert('Vista previa del ticket. Para imprimir, use el bot√≥n IMPRIMIR TICKET.');
                };
                noPrintDiv.appendChild(previewBtn);
            }
        });
    </script>
</body>
</html>