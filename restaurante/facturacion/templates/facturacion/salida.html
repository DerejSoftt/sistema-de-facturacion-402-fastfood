<!DOCTYPE html>
{% load static %}
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Salida de Productos - Restaurante</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Estilos mantenidos del original */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #ff7e5f 0%, #feb47b 100%);
            min-height: 100vh;
        }
        
        .app-container {
            display: flex;
            min-height: 100vh;
        }
        
        /* Sidebar styles - FIXED */
        .sidebar {
            width: 260px;
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            position: fixed;
            top: 0;
            left: 0;
            bottom: 0;
            z-index: 1000;
            overflow-y: auto;
        }
        
        .sidebar-header {
            background: linear-gradient(135deg, #ff7e5f 0%, #feb47b 100%);
            color: white;
            padding: 1.5rem;
            font-size: 1.25rem;
            font-weight: bold;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .sidebar-nav {
            flex: 1;
            padding: 1rem 0;
        }
        
        .nav-item {
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            color: #ecf0f1;
            text-decoration: none;
            transition: all 0.3s;
            cursor: pointer;
            border-left: 3px solid transparent;
        }
        
        .nav-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-left-color: #ff7e5f;
            color: #ff7e5f;
            transform: translateX(5px);
        }
        
        .nav-item.active {
            background: rgba(255, 255, 255, 0.15);
            border-left-color: #ff7e5f;
            color: #ff7e5f;
            font-weight: 600;
        }
        
        .nav-icon {
            font-size: 1.25rem;
        }
        
        /* Mobile menu toggle */
        .menu-toggle {
            display: none;
            position: fixed;
            top: 1rem;
            left: 1rem;
            z-index: 1001;
            background: #ff7e5f;
            border: none;
            padding: 0.75rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            font-size: 1.5rem;
            color: white;
            transition: all 0.3s;
        }
        
        .menu-toggle:hover {
            background: #ff6b4a;
            transform: scale(1.05);
        }
        
        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 998;
        }
        
        /* Main content area - adjusted for fixed sidebar */
        .main-content {
            flex: 1;
            padding: 2rem;
            overflow-x: hidden;
            margin-left: 260px;
            width: calc(100% - 260px);
        }
        
        .container {
            width: 100%;
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 25px;
            box-shadow: 0 25px 70px rgba(0, 0, 0, 0.25);
            overflow: hidden;
            animation: fadeIn 0.5s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Header */
        .header {
            background: linear-gradient(135deg, #ff7e5f 0%, #feb47b 100%);
            color: white;
            padding: 2.5rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="none"><path d="M0,0 L100,0 L100,100 Z" fill="rgba(255,255,255,0.1)"/></svg>');
            background-size: cover;
        }
        
        .header h1 {
            font-size: 2.2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            position: relative;
            z-index: 1;
        }
        
        .header p {
            opacity: 0.95;
            font-size: 1.1rem;
            position: relative;
            z-index: 1;
        }
        
        .content {
            padding: 2.5rem;
        }
        
        /* Stats Cards */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1.5rem;
            margin-bottom: 2.5rem;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #f8f9ff 0%, #ffffff 100%);
            padding: 1.5rem;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(255, 126, 95, 0.1);
            border: 1px solid rgba(255, 126, 95, 0.1);
            text-align: center;
            transition: transform 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(255, 126, 95, 0.2);
        }
        
        .stat-icon {
            font-size: 2rem;
            margin-bottom: 1rem;
            display: block;
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #ff7e5f;
            margin-bottom: 0.5rem;
        }
        
        .stat-label {
            color: #4a5568;
            font-size: 0.95rem;
            font-weight: 600;
        }
        
        /* Controls Section */
        .controls-section {
            background: linear-gradient(135deg, #f8f9ff 0%, #ffffff 100%);
            padding: 2rem;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(255, 126, 95, 0.1);
            border: 1px solid rgba(255, 126, 95, 0.1);
            margin-bottom: 2rem;
        }
        
        .controls-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .controls-header h3 {
            color: #2c3e50;
            font-size: 1.4rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .controls-header h3::before {
            content: "";
            font-size: 1.2rem;
        }
        
        /* Botones */
        .btn {
            padding: 1rem 2.5rem;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #ff7e5f 0%, #feb47b 100%);
            color: white;
            box-shadow: 0 10px 20px rgba(255, 126, 95, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 25px rgba(255, 126, 95, 0.4);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            box-shadow: 0 10px 20px rgba(76, 175, 80, 0.3);
        }
        
        .btn-success:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 25px rgba(76, 175, 80, 0.4);
        }
        
        .btn-info {
            background: linear-gradient(135deg, #2196F3 0%, #21CBF3 100%);
            color: white;
            box-shadow: 0 10px 20px rgba(33, 150, 243, 0.3);
        }
        
        .btn-info:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 25px rgba(33, 150, 243, 0.4);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #ffb347 0%, #ffcc33 100%);
            color: #2c3e50;
            box-shadow: 0 4px 6px rgba(255, 179, 71, 0.3);
        }
        
        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 10px rgba(255, 179, 71, 0.4);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
            color: white;
            box-shadow: 0 4px 6px rgba(255, 65, 108, 0.3);
        }
        
        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 10px rgba(255, 65, 108, 0.4);
        }
        
        .btn-sm {
            padding: 0.75rem 1.5rem;
            font-size: 0.95rem;
        }
        
        /* Form inputs */
        .form-group {
            display: flex;
            flex-direction: column;
            margin-bottom: 1rem;
        }
        
        .form-group label {
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: #2c3e50;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 1rem;
            border: 2px solid #e0e6ff;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s;
            background: white;
            box-shadow: 0 4px 6px rgba(50, 50, 93, 0.05);
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #ff7e5f;
            box-shadow: 0 0 0 3px rgba(255, 126, 95, 0.2);
            transform: translateY(-2px);
        }
        
        .search-box {
            flex: 1;
            min-width: 300px;
            position: relative;
        }
        
        .search-box input {
            width: 100%;
            padding: 1rem 1rem 1rem 3.5rem;
        }
        
        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.2rem;
            color: #ff7e5f;
        }
        
        .filter-select {
            padding: 1rem;
            border: 2px solid #e0e6ff;
            border-radius: 12px;
            font-size: 1rem;
            background: white;
            min-width: 180px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(50, 50, 93, 0.05);
        }
        
        .filter-row {
            display: flex;
            gap: 1rem;
            align-items: flex-end;
            flex-wrap: wrap;
        }
        
        /* Tabla de Productos */
        .table-container {
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(255, 126, 95, 0.1);
            border: 1px solid rgba(255, 126, 95, 0.1);
            margin-bottom: 2rem;
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1200px;
        }
        
        thead {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
        }
        
        thead th {
            padding: 1.5rem;
            text-align: left;
            font-weight: 600;
            font-size: 0.95rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        tbody tr {
            border-bottom: 1px solid rgba(255, 126, 95, 0.1);
            transition: all 0.2s;
        }
        
        tbody tr:hover {
            background: #f8f9ff;
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(255, 126, 95, 0.1);
        }
        
        tbody td {
            padding: 1.5rem;
            color: #4a5568;
        }
        
        /* Status badges para inventario */
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .status-disponible {
            background: linear-gradient(135deg, rgba(56, 161, 105, 0.1) 0%, rgba(72, 187, 120, 0.1) 100%);
            color: #38a169;
        }
        
        .status-bajo {
            background: linear-gradient(135deg, rgba(255, 179, 71, 0.1) 0%, rgba(255, 204, 51, 0.1) 100%);
            color: #d69e2e;
        }
        
        .status-agotado {
            background: linear-gradient(135deg, rgba(245, 101, 101, 0.1) 0%, rgba(229, 62, 62, 0.1) 100%);
            color: #e53e3e;
        }
        
        /* Categoría badges */
        .categoria-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .categoria-carne {
            background: linear-gradient(135deg, rgba(255, 99, 71, 0.1) 0%, rgba(255, 140, 105, 0.1) 100%);
            color: #ff6347;
        }
        
        .categoria-verdura {
            background: linear-gradient(135deg, rgba(34, 139, 34, 0.1) 0%, rgba(50, 205, 50, 0.1) 100%);
            color: #228b22;
        }
        
        .categoria-lacteo {
            background: linear-gradient(135deg, rgba(240, 248, 255, 0.1) 0%, rgba(230, 230, 250, 0.1) 100%);
            color: #4169e1;
        }
        
        .categoria-postre {
            background: linear-gradient(135deg, rgba(255, 20, 147, 0.1) 0%, rgba(255, 105, 180, 0.1) 100%);
            color: #ff1493;
        }
        
        .categoria-otro {
            background: linear-gradient(135deg, rgba(169, 169, 169, 0.1) 0%, rgba(105, 105, 105, 0.1) 100%);
            color: #696969;
        }
        
        /* Producto info */
        .producto-info {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }
        
        .producto-name {
            font-weight: 600;
            color: #2c3e50;
            font-size: 1.1rem;
        }
        
        .producto-desc {
            font-size: 0.9rem;
            color: #718096;
            margin-top: 0.25rem;
        }
        
        /* Cantidad */
        .cantidad-disponible {
            font-weight: 700;
            color: #2c3e50;
            font-size: 1.1rem;
        }
        
        /* Action buttons */
        .action-buttons {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        .btn-icon {
            padding: 0.5rem;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1rem;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #f8f9ff 0%, #e9ecff 100%);
            color: #667eea;
        }
        
        .btn-icon:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
        }
        
        .btn-view:hover {
            background: linear-gradient(135deg, #2196F3 0%, #21CBF3 100%);
            color: white;
        }
        
        .btn-salida {
            background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%) !important;
            color: white !important;
        }
        
        .btn-salida:hover {
            background: linear-gradient(135deg, #e5395f 0%, #e54228 100%) !important;
            color: white;
            transform: scale(1.1);
        }
        
        .btn-eliminar:hover {
            background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
            color: white;
        }
        
        .btn-editar:hover {
            background: linear-gradient(135deg, #ffb347 0%, #ffcc33 100%);
            color: #2c3e50;
        }
        
        .btn-reabastecer {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%) !important;
            color: white !important;
        }
        
        .btn-reabastecer:hover {
            background: linear-gradient(135deg, #43a047 0%, #388e3c 100%) !important;
            color: white;
            transform: scale(1.1);
        }
        
        /* Modal para registrar salida */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }
        
        .modal.active {
            display: flex;
            animation: fadeIn 0.3s ease-out;
        }
        
        .modal-content {
            background: white;
            border-radius: 20px;
            width: 100%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
        }
        
        .modal-header {
            background: linear-gradient(135deg, #ff7e5f 0%, #feb47b 100%);
            color: white;
            padding: 2rem;
            border-radius: 20px 20px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 {
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .modal-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .modal-body {
            padding: 2rem;
        }
        
        /* Estilo para el formulario de salida */
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .form-full {
            grid-column: span 2;
        }
        
        .form-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
        }
        
        /* Historial de salidas */
        .history-container {
            margin-top: 2rem;
        }
        
        .history-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        
        .history-table th {
            background: #f8f9ff;
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: #2c3e50;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .history-table td {
            padding: 1rem;
            border-bottom: 1px solid #e2e8f0;
            color: #4a5568;
        }
        
        /* Motivo badge */
        .motivo-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .motivo-venta {
            background: linear-gradient(135deg, rgba(56, 161, 105, 0.1) 0%, rgba(72, 187, 120, 0.1) 100%);
            color: #38a169;
        }
        
        .motivo-dano {
            background: linear-gradient(135deg, rgba(255, 179, 71, 0.1) 0%, rgba(255, 204, 51, 0.1) 100%);
            color: #d69e2e;
        }
        
        .motivo-ajuste {
            background: linear-gradient(135deg, rgba(156, 39, 176, 0.1) 0%, rgba(186, 104, 200, 0.1) 100%);
            color: #9c27b0;
        }
        
        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.5rem;
            margin-top: 2rem;
        }
        
        .page-btn {
            padding: 0.75rem 1.25rem;
            border: 2px solid #e0e6ff;
            background: white;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 600;
            color: #4a5568;
        }
        
        .page-btn:hover {
            background: #f8f9ff;
            border-color: #ff7e5f;
            color: #ff7e5f;
        }
        
        .page-btn.active {
            background: linear-gradient(135deg, #ff7e5f 0%, #feb47b 100%);
            color: white;
            border-color: #ff7e5f;
        }
        
        .page-info {
            padding: 0 1rem;
            color: #4a5568;
            font-weight: 600;
        }
        
        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 4rem;
            color: #a0aec0;
        }
        
        .empty-state svg {
            width: 80px;
            height: 80px;
            margin: 0 auto 1rem;
            opacity: 0.5;
        }
        
        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: #4a5568;
        }
        
        /* Date badge */
        .date-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: #f8f9ff;
            border-radius: 10px;
            font-size: 0.9rem;
            color: #4a5568;
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 2px solid #e2e8f0;
            margin-bottom: 2rem;
        }
        
        .tab {
            padding: 1rem 2rem;
            font-weight: 600;
            color: #4a5568;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
            margin-bottom: -2px;
        }
        
        .tab:hover {
            color: #ff7e5f;
        }
        
        .tab.active {
            color: #ff7e5f;
            border-bottom-color: #ff7e5f;
        }
        
        /* Responsive design */
        @media (max-width: 1400px) {
            .stats-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .menu-toggle {
                display: block;
            }
            
            .sidebar {
                transform: translateX(-100%);
            }
            
            .sidebar.open {
                transform: translateX(0);
            }
            
            .sidebar-overlay.open {
                display: block;
            }
            
            .main-content {
                padding: 5rem 1rem 1rem;
                margin-left: 0;
                width: 100%;
            }
            
            .content {
                padding: 1.5rem;
            }
            
            .header {
                padding: 2rem 1.5rem;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
            
            .stats-container {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .controls-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .filter-row {
                flex-direction: column;
                width: 100%;
            }
            
            .search-box {
                min-width: 100%;
            }
            
            .filter-select {
                width: 100%;
            }
            
            .action-buttons {
                flex-direction: row;
                flex-wrap: nowrap;
                justify-content: center;
                gap: 0.5rem;
            }
            
            .table-container {
                border-radius: 15px;
            }
            
            table {
                min-width: 1400px;
            }
            
            .modal-content {
                margin: 1rem;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .form-full {
                grid-column: span 1;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .tab {
                border-bottom: none;
                border-left: 3px solid transparent;
                margin-bottom: 0;
            }
            
            .tab.active {
                border-bottom-color: transparent;
                border-left-color: #ff7e5f;
            }
        }
        
        @media (max-width: 480px) {
            .stats-container {
                grid-template-columns: 1fr;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
            
            .modal-body {
                padding: 1.5rem;
            }
            
            .action-buttons {
                flex-direction: row;
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .btn-icon {
                width: 35px;
                height: 35px;
                font-size: 0.9rem;
            }
            
            .form-actions {
                flex-direction: column;
            }
            
            .form-actions .btn {
                width: 100%;
            }
        }
    </style>
    </style>
</head>
<body>
    <button class="menu-toggle" onclick="toggleSidebar()"><i class="fas fa-bars"></i></button>
    
    <div class="app-container">
    <!-- Sidebar navigation -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <i class="fas fa-utensils"></i> 402 FASTFOOD
        </div>
        <nav class="sidebar-nav">
            {% with user_groups=user.groups.all|join:"," %}
            
            <!-- Menú para Usuario Normal (excluye superusuarios) -->
            {% if "Usuario Normal" in user_groups and not user.is_superuser %}
            <a href="{% url 'pedidos' %}" class="nav-item {% if request.resolver_match.url_name == 'pedidos' %}active{% endif %}">
                <span class="nav-icon"><i class="fas fa-shopping-cart"></i></span>
                <span>Pedidos</span>
            </a>
            <a href="{% url 'inventario' %}" class="nav-item {% if request.resolver_match.url_name == 'inventario' %}active{% endif %}">
                <span class="nav-icon"><i class="fas fa-clipboard-list"></i></span>
                <span>Inventario</span>
            </a>
            <a href="{% url 'gestiondepedidos' %}" class="nav-item {% if request.resolver_match.url_name == 'gestiondepedidos' %}active{% endif %}">
                <span class="nav-icon"><i class="fas fa-tasks"></i></span>
                <span>Gestión de Pedidos</span>
            </a>
            <a href="{% url 'facturacion' %}" class="nav-item {% if request.resolver_match.url_name == 'facturacion' %}active{% endif %}">
                <span class="nav-icon"><i class="fas fa-receipt"></i></span>
                <span>Facturación</span>
            </a>
            <a href="{% url 'salida' %}" class="nav-item {% if request.resolver_match.url_name == 'salida' %}active{% endif %}">
                <span class="nav-icon"><i class="fas fa-box-open"></i></span>
                <span>Salida de Productos</span>
            </a>
            {% endif %}
            
            <!-- Menú para Administrador -->
            {% if "Administrador" in user_groups and not user.is_superuser %}
            <a href="{% url 'entradadeproductos' %}" class="nav-item {% if request.resolver_match.url_name == 'entradadeproductos' %}active{% endif %}">
                <span class="nav-icon"><i class="fas fa-box"></i></span>
                <span>Entrada de Productos</span>
            </a>
            <a href="{% url 'inventario' %}" class="nav-item {% if request.resolver_match.url_name == 'inventario' %}active{% endif %}">
                <span class="nav-icon"><i class="fas fa-clipboard-list"></i></span>
                <span>Inventario</span>
            </a>
            <a href="{% url 'entradadeplatillos' %}" class="nav-item {% if request.resolver_match.url_name == 'entradadeplatillos' %}active{% endif %}">
                <span class="nav-icon"><i class="fas fa-utensils"></i></span>
                <span>Entrada de Platos</span>
            </a>
            <a href="{% url 'listadeplatillos' %}" class="nav-item {% if request.resolver_match.url_name == 'listadeplatillos' %}active{% endif %}">
                <span class="nav-icon"><i class="fas fa-list"></i></span>
                <span>Gestión de Platos</span>
            </a>
            <a href="{% url 'pedidos' %}" class="nav-item {% if request.resolver_match.url_name == 'pedidos' %}active{% endif %}">
                <span class="nav-icon"><i class="fas fa-shopping-cart"></i></span>
                <span>Pedidos</span>
            </a>
            <a href="{% url 'gestiondepedidos' %}" class="nav-item {% if request.resolver_match.url_name == 'gestiondepedidos' %}active{% endif %}">
                <span class="nav-icon"><i class="fas fa-tasks"></i></span>
                <span>Gestión de Pedidos</span>
            </a>
            <a href="{% url 'facturacion' %}" class="nav-item {% if request.resolver_match.url_name == 'facturacion' %}active{% endif %}">
                <span class="nav-icon"><i class="fas fa-receipt"></i></span>
                <span>Facturación</span>
            </a>
            <a href="{% url 'salida' %}" class="nav-item {% if request.resolver_match.url_name == 'salida' %}active{% endif %}">
                <span class="nav-icon"><i class="fas fa-box-open"></i></span>
                <span>Salida de Productos</span>
            </a>
            <a href="{% url 'roles' %}" class="nav-item {% if request.resolver_match.url_name == 'roles' %}active{% endif %}">
                <span class="nav-icon"><i class="fas fa-users"></i></span>
                <span>Gestión de Usuarios</span>
            </a>
            {% endif %}
            
            <!-- Menú para Gerente -->
            {% if "Gerente" in user_groups and not user.is_superuser %}
            <a href="{% url 'entradadeproductos' %}" class="nav-item {% if request.resolver_match.url_name == 'entradadeproductos' %}active{% endif %}">
                <span class="nav-icon"><i class="fas fa-box"></i></span>
                <span>Entrada de Productos</span>
            </a>
            <a href="{% url 'inventario' %}" class="nav-item {% if request.resolver_match.url_name == 'inventario' %}active{% endif %}">
                <span class="nav-icon"><i class="fas fa-clipboard-list"></i></span>
                <span>Inventario</span>
            </a>
            <a href="{% url 'entradadeplatillos' %}" class="nav-item {% if request.resolver_match.url_name == 'entradadeplatillos' %}active{% endif %}">
                <span class="nav-icon"><i class="fas fa-utensils"></i></span>
                <span>Entrada de Platos</span>
            </a>
            <a href="{% url 'listadeplatillos' %}" class="nav-item {% if request.resolver_match.url_name == 'listadeplatillos' %}active{% endif %}">
                <span class="nav-icon"><i class="fas fa-list"></i></span>
                <span>Gestión de Platos</span>
            </a>
            <a href="{% url 'pedidos' %}" class="nav-item {% if request.resolver_match.url_name == 'pedidos' %}active{% endif %}">
                <span class="nav-icon"><i class="fas fa-shopping-cart"></i></span>
                <span>Pedidos</span>
            </a>
            <a href="{% url 'gestiondepedidos' %}" class="nav-item {% if request.resolver_match.url_name == 'gestiondepedidos' %}active{% endif %}">
                <span class="nav-icon"><i class="fas fa-tasks"></i></span>
                <span>Gestión de Pedidos</span>
            </a>
            <a href="{% url 'facturacion' %}" class="nav-item {% if request.resolver_match.url_name == 'facturacion' %}active{% endif %}">
                <span class="nav-icon"><i class="fas fa-receipt"></i></span>
                <span>Facturación</span>
            </a>
            <a href="{% url 'salida' %}" class="nav-item {% if request.resolver_match.url_name == 'salida' %}active{% endif %}">
                <span class="nav-icon"><i class="fas fa-box-open"></i></span>
                <span>Salida de Productos</span>
            </a>
            {% endif %}
            
            <!-- Menú para Cajero -->
            {% if "Cajero" in user_groups and not user.is_superuser %}
            <a href="{% url 'pedidos' %}" class="nav-item {% if request.resolver_match.url_name == 'pedidos' %}active{% endif %}">
                <span class="nav-icon"><i class="fas fa-shopping-cart"></i></span>
                <span>Pedidos</span>
            </a>
            <a href="{% url 'facturacion' %}" class="nav-item {% if request.resolver_match.url_name == 'facturacion' %}active{% endif %}">
                <span class="nav-icon"><i class="fas fa-receipt"></i></span>
                <span>Facturación</span>
            </a>
            {% endif %}
            
            <!-- Menú EXCLUSIVO para superusuarios -->
            {% if user.is_superuser %}
            <a href="{% url 'entradadeproductos' %}" class="nav-item {% if request.resolver_match.url_name == 'entradadeproductos' %}active{% endif %}">
                <span class="nav-icon"><i class="fas fa-box"></i></span>
                <span>Entrada de Productos</span>
            </a>
            <a href="{% url 'inventario' %}" class="nav-item {% if request.resolver_match.url_name == 'inventario' %}active{% endif %}">
                <span class="nav-icon"><i class="fas fa-clipboard-list"></i></span>
                <span>Inventario</span>
            </a>
            <a href="{% url 'entradadeplatillos' %}" class="nav-item {% if request.resolver_match.url_name == 'entradadeplatillos' %}active{% endif %}">
                <span class="nav-icon"><i class="fas fa-utensils"></i></span>
                <span>Entrada de Platos</span>
            </a>
            <a href="{% url 'listadeplatillos' %}" class="nav-item {% if request.resolver_match.url_name == 'listadeplatillos' %}active{% endif %}">
                <span class="nav-icon"><i class="fas fa-list"></i></span>
                <span>Gestión de Platos</span>
            </a>
            <a href="{% url 'pedidos' %}" class="nav-item {% if request.resolver_match.url_name == 'pedidos' %}active{% endif %}">
                <span class="nav-icon"><i class="fas fa-shopping-cart"></i></span>
                <span>Pedidos</span>
            </a>
            <a href="{% url 'gestiondepedidos' %}" class="nav-item {% if request.resolver_match.url_name == 'gestiondepedidos' %}active{% endif %}">
                <span class="nav-icon"><i class="fas fa-tasks"></i></span>
                <span>Gestión de Pedidos</span>
            </a>
            <a href="{% url 'facturacion' %}" class="nav-item {% if request.resolver_match.url_name == 'facturacion' %}active{% endif %}">
                <span class="nav-icon"><i class="fas fa-receipt"></i></span>
                <span>Facturación</span>
            </a>
            <a href="{% url 'salida' %}" class="nav-item {% if request.resolver_match.url_name == 'salida' %}active{% endif %}">
                <span class="nav-icon"><i class="fas fa-box-open"></i></span>
                <span>Salida de Productos</span>
            </a>
            <a href="{% url 'roles' %}" class="nav-item {% if request.resolver_match.url_name == 'roles' %}active{% endif %}">
                <span class="nav-icon"><i class="fas fa-users"></i></span>
                <span>Gestión de Usuarios</span>
            </a>
            <a href="{% url 'dashbort' %}" class="nav-item {% if request.resolver_match.url_name == 'dashbort' %}active{% endif %}">
                <span class="nav-icon"><i class="fas fa-chart-bar"></i></span>
                <span>Dashboard</span>
            </a>
            {% endif %}
            
            <!-- Cerrar sesión para todos -->
            <a href="{% url 'logout' %}" class="nav-item">
                <span class="nav-icon"><i class="fas fa-door-open"></i></span>
                <span>Cerrar Sesión</span>
            </a>
            
            {% endwith %}
        </nav>
    </div>
    
        
        <!-- Overlay for mobile sidebar -->
        <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>
        
        <div class="main-content">
            <div class="container">
                <div class="header">
                    <h1><i class="fas fa-box-open"></i> Salida de Productos</h1>
                    <p>Registra la salida de productos y controla tu inventario</p>
                </div>
                
                <div class="content">
                    <!-- Tabs -->
                    <div class="tabs" id="tabs">
                        <div class="tab active" onclick="switchTab('inventario')">
                            <i class="fas fa-box"></i> Inventario de Productos
                        </div>
                        <div class="tab" onclick="switchTab('historial')">
                            <i class="fas fa-history"></i> Historial de Salidas
                        </div>
                        <div class="tab" onclick="switchTab('reportes')">
                            <i class="fas fa-chart-bar"></i> Reportes
                        </div>
                    </div>
                    
                    <!-- Contenido de Inventario -->
                    <div id="inventarioTab" class="tab-content">
                        <!-- Stats Cards -->
                        <div class="stats-container">
                            <div class="stat-card">
                                <span class="stat-icon"><i class="fas fa-box"></i></span>
                                <div class="stat-value" id="totalProductos">{{ total_productos }}</div>
                                <div class="stat-label">Total Productos</div>
                            </div>
                            <div class="stat-card">
                                <span class="stat-icon"><i class="fas fa-balance-scale"></i></span>
                                <div class="stat-value" id="cantidadTotal">{{ total_cantidad|floatformat:2 }}</div>
                                <div class="stat-label">Cantidad Total</div>
                            </div>
                            <div class="stat-card">
                                <span class="stat-icon"><i class="fas fa-exclamation-triangle"></i></span>
                                <div class="stat-value" id="productosBajos">{{ productos_bajos }}</div>
                                <div class="stat-label">Stock Bajo</div>
                            </div>
                            <div class="stat-card">
                                <span class="stat-icon"><i class="fas fa-sync-alt"></i></span>
                                <div class="stat-value" id="salidasHoy">0</div>
                                <div class="stat-label">Salidas Hoy</div>
                            </div>
                        </div>
                        
                        <!-- Controls Section -->
                        <div class="controls-section">
                            <div class="controls-header">
                                <h3>Buscar y Filtrar Productos</h3>
                                <div style="display: flex; gap: 1rem;">
                                    <button class="btn btn-info btn-sm" onclick="exportReport()">
                                        <span><i class="fas fa-file-export"></i></span>
                                        <span>Exportar</span>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="searchInput"><i class="fas fa-search"></i> Buscar Producto</label>
                                <div class="search-box">
                                    <span class="search-icon"><i class="fas fa-search"></i></span>
                                    <input type="text" id="searchInput" placeholder="Buscar por nombre, categoría...">
                                </div>
                            </div>
                            
                            <div class="filter-row">
                                <div class="form-group" style="flex: 1;">
                                    <label for="categoriaFilter"><i class="fas fa-tags"></i> Categoría</label>
                                    <select class="filter-select" id="categoriaFilter">
                                        <option value="">Todas las categorías</option>
                                        <option value="carne">Carne</option>
                                        <option value="verdura">Verdura</option>
                                        <option value="lacteo">Lácteo</option>
                                        <option value="postre">Postre</option>
                                        <option value="otro">Otro</option>
                                    </select>
                                </div>
                                
                                <div class="form-group" style="flex: 1;">
                                    <label for="stockFilter"><i class="fas fa-chart-bar"></i> Estado de Stock</label>
                                    <select class="filter-select" id="stockFilter">
                                        <option value="">Todos</option>
                                        <option value="disponible">Disponible</option>
                                        <option value="bajo">Stock Bajo</option>
                                        <option value="agotado">Agotado</option>
                                    </select>
                                </div>
                                
                                <div class="form-group" style="flex: 1;">
                                    <label for="sortFilter"><i class="fas fa-sort"></i> Ordenar por</label>
                                    <select class="filter-select" id="sortFilter">
                                        <option value="nombre">Nombre (A-Z)</option>
                                        <option value="cantidad">Cantidad (Mayor a menor)</option>
                                        <option value="salidas">Salidas (Recientes)</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Productos Table -->
                        <div class="table-container">
                            <table id="productosTable">
                                <thead>
                                    <tr>
                                        <th>Producto</th>
                                        <th>Categoría</th>
                                        <th>Cantidad Disponible</th>
                                        <th>Stock Mínimo</th>
                                        <th>Estado</th>
                                        <th>Última Salida</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="productosBody">
                                    <!-- Productos will be loaded here dynamically -->
                                    <tr class="empty-state">
                                        <td colspan="7">
                                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                                            </svg>
                                            <h3>Cargando productos...</h3>
                                            <p>Los productos se están cargando desde la base de datos</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Pagination -->
                        <div class="pagination" id="pagination" style="display: none;">
                            <button class="page-btn" onclick="changePage(-1)">← Anterior</button>
                            <span class="page-info" id="pageInfo">Página 1 de 1</span>
                            <button class="page-btn" onclick="changePage(1)">Siguiente →</button>
                        </div>
                    </div>
                    
                    <!-- Contenido de Historial -->
                    <div id="historialTab" class="tab-content" style="display: none;">
                        <!-- Controls Section -->
                        <div class="controls-section">
                            <div class="controls-header">
                                <h3>Historial de Salidas de Productos</h3>
                                <div style="display: flex; gap: 1rem;">
                                    <button class="btn btn-info btn-sm" onclick="exportHistorial()">
                                        <span><i class="fas fa-file-export"></i></span>
                                        <span>Exportar Historial</span>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="filter-row">
                                <div class="form-group" style="flex: 1;">
                                    <label for="historialProductoFilter"><i class="fas fa-box"></i> Producto</label>
                                    <select class="filter-select" id="historialProductoFilter">
                                        <option value="">Todos los productos</option>
                                        <!-- Productos will be loaded dynamically -->
                                    </select>
                                </div>
                                
                                <div class="form-group" style="flex: 1;">
                                    <label for="historialMotivoFilter"><i class="fas fa-bullseye"></i> Motivo</label>
                                    <select class="filter-select" id="historialMotivoFilter">
                                        <option value="">Todos los motivos</option>
                                        <option value="venta">Venta</option>
                                        <option value="dano">Daño/Desperdicio</option>
                                        <option value="ajuste">Ajuste de Inventario</option>
                                        <option value="consumo">Consumo Interno</option>
                                    </select>
                                </div>
                                
                                <div class="form-group" style="flex: 1;">
                                    <label for="historialFechaFilter"><i class="fas fa-calendar-alt"></i> Rango de Fechas</label>
                                    <select class="filter-select" id="historialFechaFilter">
                                        <option value="hoy">Hoy</option>
                                        <option value="ayer">Ayer</option>
                                        <option value="semana">Esta Semana</option>
                                        <option value="mes">Este Mes</option>
                                        <option value="personalizado">Personalizado</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="filter-row" id="fechasPersonalizadas" style="display: none;">
                                <div class="form-group" style="flex: 1;">
                                    <label for="fechaDesde"><i class="fas fa-calendar-day"></i> Desde</label>
                                    <input type="date" id="fechaDesde" class="filter-select">
                                </div>
                                
                                <div class="form-group" style="flex: 1;">
                                    <label for="fechaHasta"><i class="fas fa-calendar-day"></i> Hasta</label>
                                    <input type="date" id="fechaHasta" class="filter-select">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Historial Table -->
                        <div class="table-container">
                            <table id="historialTable">
                                <thead>
                                    <tr>
                                        <th>Fecha y Hora</th>
                                        <th>Producto</th>
                                        <th>Cantidad</th>
                                        <th>Motivo</th>
                                        <th>Responsable</th>
                                        <th>Observaciones</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="historialBody">
                                    <!-- Historial will be loaded here dynamically -->
                                    <tr class="empty-state">
                                        <td colspan="7">
                                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                                            </svg>
                                            <h3>No hay registro de salidas</h3>
                                            <p>Registra la primera salida de productos</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Contenido de Reportes -->
                    <div id="reportesTab" class="tab-content" style="display: none;">
                        <div class="stats-container">
                            <div class="stat-card">
                                <span class="stat-icon"><i class="fas fa-chart-line"></i></span>
                                <div class="stat-value" id="totalSalidasMes">0</div>
                                <div class="stat-label">Salidas este Mes</div>
                            </div>
                            <div class="stat-card">
                                <span class="stat-icon"><i class="fas fa-dollar-sign"></i></span>
                                <div class="stat-value" id="valorPerdidas">$0</div>
                                <div class="stat-label">Valor Perdidas</div>
                            </div>
                            <div class="stat-card">
                                <span class="stat-icon"><i class="fas fa-box"></i></span>
                                <div class="stat-value" id="productoMasVendido">-</div>
                                <div class="stat-label">Producto Más Salido</div>
                            </div>
                            <div class="stat-card">
                                <span class="stat-icon"><i class="fas fa-chart-bar"></i></span>
                                <div class="stat-value" id="promedioDiario">0</div>
                                <div class="stat-label">Promedio Diario</div>
                            </div>
                        </div>
                        
                        <div class="controls-section">
                            <div class="controls-header">
                                <h3>Reportes de Salidas</h3>
                                <div style="display: flex; gap: 1rem;">
                                    <button class="btn btn-primary btn-sm" onclick="generarReporteMensual()">
                                        <span><i class="fas fa-file-alt"></i></span>
                                        <span>Generar Reporte Mensual</span>
                                    </button>
                                    <button class="btn btn-info btn-sm" onclick="exportReporteCompleto()">
                                        <span><i class="fas fa-file-export"></i></span>
                                        <span>Exportar Reporte Completo</span>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="filter-row">
                                <div class="form-group" style="flex: 1;">
                                    <label for="reporteTipo"><i class="fas fa-chart-bar"></i> Tipo de Reporte</label>
                                    <select class="filter-select" id="reporteTipo">
                                        <option value="mensual">Mensual</option>
                                        <option value="semanal">Semanal</option>
                                        <option value="diario">Diario</option>
                                        <option value="categoria">Por Categoría</option>
                                        <option value="motivo">Por Motivo</option>
                                    </select>
                                </div>
                                
                                <div class="form-group" style="flex: 1;">
                                    <label for="reportePeriodo"><i class="fas fa-calendar-alt"></i> Período</label>
                                    <select class="filter-select" id="reportePeriodo">
                                        <option value="enero">Enero 2024</option>
                                        <option value="febrero">Febrero 2024</option>
                                        <option value="marzo">Marzo 2024</option>
                                        <option value="abril">Abril 2024</option>
                                        <option value="mayo">Mayo 2024</option>
                                    </select>
                                </div>
                                
                                <div class="form-group" style="flex: 1;">
                                    <label for="reporteFormato"><i class="fas fa-print"></i> Formato</label>
                                    <select class="filter-select" id="reporteFormato">
                                        <option value="grafico">Gráfico</option>
                                        <option value="tabla">Tabla</option>
                                        <option value="resumen">Resumen Ejecutivo</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Gráfico de Reportes -->
                        <div class="table-container" style="padding: 2rem; text-align: center;">
                            <h3 style="color: #2c3e50; margin-bottom: 1.5rem;"><i class="fas fa-chart-line"></i> Gráfico de Salidas por Producto</h3>
                            <div style="height: 300px; display: flex; align-items: flex-end; justify-content: center; gap: 20px; padding: 20px;">
                                <!-- Barras del gráfico se generarán dinámicamente -->
                                <div id="graficoBarras"></div>
                            </div>
                            <div style="margin-top: 2rem;">
                                <h4 style="color: #2c3e50; margin-bottom: 1rem;">Resumen de Actividad</h4>
                                <div id="resumenActividad" style="text-align: left; padding: 1rem; background: #f8f9ff; border-radius: 12px;">
                                    <!-- Resumen se generará dinámicamente -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal para registrar salida -->
    <div class="modal" id="salidaModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-box-open"></i> Registrar Salida de Producto</h3>
                <button class="modal-close" onclick="closeModal()">×</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="productoId">
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="productoNombre"><i class="fas fa-box"></i> Producto</label>
                        <input type="text" id="productoNombre" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label for="stockActual"><i class="fas fa-balance-scale"></i> Stock Actual</label>
                        <input type="text" id="stockActual" readonly>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="cantidadSalida"><i class="fas fa-hashtag"></i> Cantidad a Retirar</label>
                        <input type="text" id="cantidadSalida" placeholder="0.00">
                        <small style="color: #718096; margin-top: 0.5rem;">Cantidad a retirar (puede ser decimal)</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="motivoSalida"><i class="fas fa-bullseye"></i> Motivo de Salida</label>
                        <select class="filter-select" id="motivoSalida">
                            <option value="venta">Venta</option>
                            <option value="dano">Daño/Desperdicio</option>
                            <option value="ajuste">Ajuste de Inventario</option>
                            <option value="consumo">Consumo Interno</option>
                            <option value="otro">Otro</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group form-full">
                    <label for="responsableSalida"><i class="fas fa-user"></i> Responsable</label>
                    <input type="text" id="responsableSalida" placeholder="Nombre del responsable" value="Administrador">
                </div>
                
                <div class="form-group form-full">
                    <label for="observacionesSalida"><i class="fas fa-edit"></i> Observaciones</label>
                    <textarea id="observacionesSalida" rows="3" placeholder="Observaciones adicionales..."></textarea>
                </div>
                
                <div class="form-actions">
                    <button class="btn" onclick="closeModal()" style="background: #f8f9ff; color: #4a5568;">
                        Cancelar
                    </button>
                    <button class="btn btn-primary" onclick="registrarSalida()" id="registrarSalidaBtn">
                        <span><i class="fas fa-box-open"></i></span>
                        <span>Registrar Salida</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para reabastecer stock -->
    <div class="modal" id="reabastecerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-box"></i> Reabastecer Stock</h3>
                <button class="modal-close" onclick="closeReabastecerModal()">×</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="reabastecerProductoId">
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="reabastecerNombre"><i class="fas fa-box"></i> Producto</label>
                        <input type="text" id="reabastecerNombre" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label for="reabastecerStockActual"><i class="fas fa-balance-scale"></i> Stock Actual</label>
                        <input type="text" id="reabastecerStockActual" readonly>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="cantidadReabastecer"><i class="fas fa-hashtag"></i> Cantidad a Agregar</label>
                        <input type="text" id="cantidadReabastecer" placeholder="0.00" value="10.00">
                    </div>
                    
                    <div class="form-group">
                        <label for="motivoReabastecer"><i class="fas fa-bullseye"></i> Motivo</label>
                        <select class="filter-select" id="motivoReabastecer">
                            <option value="compra">Compra</option>
                            <option value="transferencia">Transferencia</option>
                            <option value="produccion">Producción Interna</option>
                            <option value="ajuste">Ajuste de Inventario</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group form-full">
                    <label for="observacionesReabastecer"><i class="fas fa-edit"></i> Observaciones</label>
                    <textarea id="observacionesReabastecer" rows="3" placeholder="Observaciones sobre el reabastecimiento..."></textarea>
                </div>
                
                <div class="form-actions">
                    <button class="btn" onclick="closeReabastecerModal()" style="background: #f8f9ff; color: #4a5568;">
                        Cancelar
                    </button>
                    <button class="btn btn-success" onclick="confirmarReabastecimiento()">
                        <span><i class="fas fa-box"></i></span>
                        <span>Confirmar Reabastecimiento</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Función para formatear números con comas para miles
        function formatearNumero(valor) {
            const numero = parseFloat(valor);
            if (isNaN(numero)) return '0.00';
            
            const partes = numero.toFixed(2).split('.');
            const entero = partes[0];
            const decimal = partes[1];
            
            // Agregar comas para los miles
            const enteroFormateado = entero.replace(/\B(?=(\d{3})+(?!\d))/g, ',');
            
            return enteroFormateado + '.' + decimal;
        }
        
        // Función para formatear moneda en formato US
        function formatearMoneda(valor) {
            return '$' + formatearNumero(valor);
        }
        
        // Variables globales
        let productos = [];
        let salidas = [];
        let filteredProductos = [];
        let currentPage = 1;
        const itemsPerPage = 10;
        let currentTab = 'inventario';
        
        // Inicializar la aplicación
        document.addEventListener('DOMContentLoaded', function() {
            console.log('=== INICIANDO SISTEMA DE SALIDA DE PRODUCTOS ===');
            
            // Cargar productos desde la base de datos Django
            cargarProductosDesdeDjango();
            
            // Cargar historial desde localStorage
            cargarHistorialDesdeStorage();
            
            // Llamar a las funciones de renderizado
            setupEventListeners();
            
            console.log('Sistema inicializado');
        });
        
        // Cargar productos desde Django (datos reales)
        async function cargarProductosDesdeDjango() {
            try {
                console.log('Cargando productos desde Django...');
                
                // Hacer una petición AJAX para obtener los productos reales
                const response = await fetch('/obtener-productos-salida/');
                const data = await response.json();
                
                if (data.success) {
                    console.log(`✅ ${data.productos.length} productos cargados desde Django`);
                    
                    productos = data.productos.map(producto => ({
                        id: producto.id,
                        nombre: producto.nombre,
                        codigo: producto.codigo,
                        categoria: producto.categoria,
                        cantidad: parseFloat(producto.cantidad),
                        precio_compra: parseFloat(producto.precio_compra),
                        subtotal: parseFloat(producto.subtotal),
                        descripcion: `Código: ${producto.codigo} | Precio: ${formatearMoneda(producto.precio_compra)}`,
                        stockMinimo: getStockMinimoByCategory(producto.categoria),
                        fechaCreacion: producto.fecha_creacion,
                        ultimaSalida: producto.ultima_salida || null
                    }));
                    
                    filteredProductos = [...productos];
                    renderProductos();
                    actualizarEstadisticas();
                    cargarFiltroProductos();
                    
                    mostrarNotificacion(`${productos.length} productos cargados correctamente`, 'success');
                } else {
                    console.error('Error al cargar productos:', data.error);
                    mostrarNotificacion('Error al cargar productos desde la base de datos', 'error');
                }
                
            } catch (error) {
                console.error('Error en la petición:', error);
                mostrarNotificacion('Error de conexión al cargar productos', 'error');
            }
        }
        
        // Cargar historial desde localStorage
        function cargarHistorialDesdeStorage() {
            try {
                const historialGuardado = localStorage.getItem('historialSalidasProductos');
                if (historialGuardado) {
                    salidas = JSON.parse(historialGuardado);
                    console.log(`✅ ${salidas.length} registros de salida cargados`);
                } else {
                    salidas = [];
                    console.log('ℹ️ No hay historial de salidas guardado');
                }
            } catch (error) {
                console.error('❌ Error cargando historial:', error);
                salidas = [];
            }
        }
        
        // Guardar historial en localStorage
        function guardarHistorialEnStorage() {
            try {
                localStorage.setItem('historialSalidasProductos', JSON.stringify(salidas));
                console.log(`💾 Historial guardado: ${salidas.length} registros`);
            } catch (error) {
                console.error('❌ Error guardando historial:', error);
            }
        }
        
        // Función para obtener stock mínimo por categoría
        function getStockMinimoByCategory(categoria) {
            const stockMinimo = {
                'carne': 10,
                'verdura': 15,
                'lacteo': 12,
                'postre': 8,
                'otro': 5,
                'bebida': 10  // Aunque excluimos bebidas, por si acaso
            };
            return stockMinimo[categoria] || 10;
        }
        
        // Configurar event listeners
        function setupEventListeners() {
            const searchInput = document.getElementById('searchInput');
            const categoriaFilter = document.getElementById('categoriaFilter');
            const stockFilter = document.getElementById('stockFilter');
            const sortFilter = document.getElementById('sortFilter');
            
            if (searchInput) {
                searchInput.addEventListener('input', filtrarYRenderizar);
            }
            
            if (categoriaFilter) {
                categoriaFilter.addEventListener('change', filtrarYRenderizar);
            }
            
            if (stockFilter) {
                stockFilter.addEventListener('change', filtrarYRenderizar);
            }
            
            if (sortFilter) {
                sortFilter.addEventListener('change', filtrarYRenderizar);
            }
            
            // Listeners para el historial
            const historialProductoFilter = document.getElementById('historialProductoFilter');
            const historialMotivoFilter = document.getElementById('historialMotivoFilter');
            const historialFechaFilter = document.getElementById('historialFechaFilter');
            
            if (historialProductoFilter) {
                historialProductoFilter.addEventListener('change', filtrarHistorial);
            }
            
            if (historialMotivoFilter) {
                historialMotivoFilter.addEventListener('change', filtrarHistorial);
            }
            
            if (historialFechaFilter) {
                historialFechaFilter.addEventListener('change', function() {
                    const valor = this.value;
                    const fechasPersonalizadas = document.getElementById('fechasPersonalizadas');
                    
                    if (valor === 'personalizado') {
                        fechasPersonalizadas.style.display = 'flex';
                    } else {
                        fechasPersonalizadas.style.display = 'none';
                    }
                    
                    filtrarHistorial();
                });
            }
            
            // Event listeners para formatear inputs con comas
            const cantidadSalida = document.getElementById('cantidadSalida');
            const cantidadReabastecer = document.getElementById('cantidadReabastecer');
            
            if (cantidadSalida) {
                cantidadSalida.addEventListener('input', function(e) {
                    let valor = e.target.value.replace(/[^0-9.]/g, '');
                    let partes = valor.split('.');
                    if (partes.length > 2) valor = partes[0] + '.' + partes.slice(1).join('');
                    if (valor) {
                        let [entero, decimal] = valor.split('.');
                        entero = entero.replace(/\B(?=(\d{3})+(?!\d))/g, ',');
                        e.target.value = decimal !== undefined ? entero + '.' + decimal : entero;
                    }
                });
            }
            
            if (cantidadReabastecer) {
                cantidadReabastecer.addEventListener('input', function(e) {
                    let valor = e.target.value.replace(/[^0-9.]/g, '');
                    let partes = valor.split('.');
                    if (partes.length > 2) valor = partes[0] + '.' + partes.slice(1).join('');
                    if (valor) {
                        let [entero, decimal] = valor.split('.');
                        entero = entero.replace(/\B(?=(\d{3})+(?!\d))/g, ',');
                        e.target.value = decimal !== undefined ? entero + '.' + decimal : entero;
                    }
                });
            }
            
            // Listeners para fechas personalizadas
            const fechaDesde = document.getElementById('fechaDesde');
            const fechaHasta = document.getElementById('fechaHasta');
            
            if (fechaDesde) {
                fechaDesde.addEventListener('change', filtrarHistorial);
            }
            
            if (fechaHasta) {
                fechaHasta.addEventListener('change', filtrarHistorial);
            }
        }
        
        // Filtrar y renderizar productos
        function filtrarYRenderizar() {
            filtrarProductos();
            renderProductos();
        }
        
        // Filtrar productos
        function filtrarProductos() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const selectedCategoria = document.getElementById('categoriaFilter').value;
            const selectedStock = document.getElementById('stockFilter').value;
            const selectedSort = document.getElementById('sortFilter').value;
            
            // Si no hay productos, retornar array vacío
            if (!productos || productos.length === 0) {
                filteredProductos = [];
                return;
            }
            
            filteredProductos = productos.filter(producto => {
                // Validar que el producto existe
                if (!producto) return false;
                
                // Excluir bebidas
                if (producto.categoria === 'bebida') return false;
                
                // 1. Filtrar por búsqueda
                let matchesSearch = true;
                if (searchTerm) {
                    matchesSearch = (
                        producto.nombre.toLowerCase().includes(searchTerm) ||
                        producto.codigo.toLowerCase().includes(searchTerm) ||
                        producto.categoria.toLowerCase().includes(searchTerm)
                    );
                }
                
                // 2. Filtrar por categoría
                let matchesCategoria = true;
                if (selectedCategoria) {
                    matchesCategoria = producto.categoria === selectedCategoria;
                }
                
                // 3. Filtrar por estado de stock
                let matchesStock = true;
                if (selectedStock) {
                    if (selectedStock === 'disponible') {
                        matchesStock = producto.cantidad > producto.stockMinimo;
                    } else if (selectedStock === 'bajo') {
                        matchesStock = producto.cantidad <= producto.stockMinimo && producto.cantidad > 0;
                    } else if (selectedStock === 'agotado') {
                        matchesStock = producto.cantidad === 0;
                    }
                }
                
                return matchesSearch && matchesCategoria && matchesStock;
            });
            
            // Ordenar según la opción seleccionada
            switch(selectedSort) {
                case 'nombre':
                    filteredProductos.sort((a, b) => a.nombre.localeCompare(b.nombre));
                    break;
                case 'cantidad':
                    filteredProductos.sort((a, b) => b.cantidad - a.cantidad);
                    break;
                case 'salidas':
                    // Ordenar por última salida (más reciente primero)
                    filteredProductos.sort((a, b) => {
                        const fechaA = a.ultimaSalida ? new Date(a.ultimaSalida) : new Date(0);
                        const fechaB = b.ultimaSalida ? new Date(b.ultimaSalida) : new Date(0);
                        return fechaB - fechaA;
                    });
                    break;
            }
            
            currentPage = 1; // Resetear a la primera página
        }
        
        // Renderizar productos
        function renderProductos() {
            const productosBody = document.getElementById('productosBody');
            const pagination = document.getElementById('pagination');
            
            if (!productosBody) {
                console.error('ERROR: No se encontró el elemento productosBody');
                return;
            }
            
            // Calcular paginación
            const totalPages = Math.ceil(filteredProductos.length / itemsPerPage);
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const currentItems = filteredProductos.slice(startIndex, endIndex);
            
            // Mostrar/Ocultar paginación
            if (filteredProductos.length > itemsPerPage) {
                pagination.style.display = 'flex';
                document.getElementById('pageInfo').textContent = `Página ${currentPage} de ${totalPages}`;
            } else {
                pagination.style.display = 'none';
            }
            
            // Mostrar estado vacío si no hay productos
            if (currentItems.length === 0) {
                productosBody.innerHTML = `
                    <tr class="empty-state">
                        <td colspan="7">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                            </svg>
                            <h3>No se encontraron productos</h3>
                            <p>${productos.length === 0 ? 'No hay productos en la base de datos.' : 'Intenta con otros filtros de búsqueda'}</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Renderizar productos
            let htmlContent = '';
            
            for (let i = 0; i < currentItems.length; i++) {
                const producto = currentItems[i];
                
                // Determinar estado del stock
                let estado = 'disponible';
                let estadoClass = 'status-disponible';
                let estadoTexto = 'Disponible';
                
                if (producto.cantidad === 0) {
                    estado = 'agotado';
                    estadoClass = 'status-agotado';
                    estadoTexto = 'Agotado';
                } else if (producto.cantidad <= producto.stockMinimo) {
                    estado = 'bajo';
                    estadoClass = 'status-bajo';
                    estadoTexto = 'Stock Bajo';
                }
                
                // Formatear última salida
                let ultimaSalidaFormateada = 'No registrada';
                if (producto.ultimaSalida) {
                    try {
                        const fecha = new Date(producto.ultimaSalida);
                        ultimaSalidaFormateada = fecha.toLocaleDateString('es-ES', {
                            day: '2-digit',
                            month: '2-digit',
                            year: 'numeric',
                            hour: '2-digit',
                            minute: '2-digit'
                        });
                    } catch (e) {
                        console.error('Error procesando fecha:', e);
                    }
                }
                
                // Obtener unidad de medida
                const unidad = getUnidadMedida(producto.categoria);
                
                // Construir fila HTML
                htmlContent += `
                    <tr>
                        <td>
                            <div class="producto-info">
                                <span class="producto-name">${producto.nombre}</span>
                                <span class="producto-desc">${producto.descripcion}</span>
                            </div>
                        </td>
                        <td>
                            <span class="categoria-badge categoria-${producto.categoria}">
                                <span>${getCategoriaIcon(producto.categoria)}</span>
                                ${getCategoriaLabel(producto.categoria)}
                            </span>
                        </td>
                        <td>
                            <div class="cantidad-disponible">${formatearNumero(producto.cantidad)} ${unidad}</div>
                        </td>
                        <td>
                            <div>${formatearNumero(producto.stockMinimo)} ${unidad}</div>
                        </td>
                        <td>
                            <span class="status-badge ${estadoClass}">
                                ${estadoTexto}
                            </span>
                        </td>
                        <td>
                            <div class="date-badge">
                                <span><i class="fas fa-calendar-alt"></i></span>
                                <span>${ultimaSalidaFormateada}</span>
                            </div>
                        </td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn-icon btn-salida" onclick="registrarSalidaModal('${producto.id}')" title="Registrar salida">
                                    <i class="fas fa-minus-circle"></i>
                                </button>
                                <button class="btn-icon btn-reabastecer" onclick="reabastecerModal('${producto.id}')" title="Reabastecer stock">
                                    <i class="fas fa-plus-circle"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }
            
            // Insertar HTML en la tabla
            productosBody.innerHTML = htmlContent;
        }
        
        // Actualizar estadísticas
        function actualizarEstadisticas() {
            // Total de productos (excluyendo bebidas)
            const totalProductosElement = document.getElementById('totalProductos');
            if (totalProductosElement) {
                const productosSinBebidas = productos.filter(p => p.categoria !== 'bebida');
                totalProductosElement.textContent = productosSinBebidas.length;
            }
            
            // Cantidad total disponible (excluyendo bebidas)
            const cantidadTotalElement = document.getElementById('cantidadTotal');
            if (cantidadTotalElement) {
                const cantidadTotal = productos
                    .filter(p => p.categoria !== 'bebida')
                    .reduce((sum, producto) => sum + producto.cantidad, 0);
                cantidadTotalElement.textContent = formatearNumero(cantidadTotal);
            }
            
            // Productos con stock bajo (excluyendo bebidas)
            const productosBajosElement = document.getElementById('productosBajos');
            if (productosBajosElement) {
                const productosBajos = productos.filter(producto => 
                    producto.categoria !== 'bebida' &&
                    producto.cantidad <= producto.stockMinimo && 
                    producto.cantidad > 0
                ).length;
                productosBajosElement.textContent = productosBajos;
            }
            
            // Salidas hoy
            const salidasHoyElement = document.getElementById('salidasHoy');
            if (salidasHoyElement) {
                const hoy = new Date();
                hoy.setHours(0, 0, 0, 0);
                
                const salidasHoy = salidas.filter(salida => {
                    try {
                        const fechaSalida = new Date(salida.fecha);
                        fechaSalida.setHours(0, 0, 0, 0);
                        return fechaSalida.getTime() === hoy.getTime();
                    } catch (e) {
                        return false;
                    }
                }).length;
                
                salidasHoyElement.textContent = salidasHoy;
            }
            
            // Actualizar estadísticas de reportes
            actualizarEstadisticasReportes();
        }
        
        // Actualizar estadísticas de reportes
        function actualizarEstadisticasReportes() {
            // Total salidas este mes
            const totalSalidasMesElement = document.getElementById('totalSalidasMes');
            if (totalSalidasMesElement) {
                const hoy = new Date();
                const primerDiaMes = new Date(hoy.getFullYear(), hoy.getMonth(), 1);
                
                const salidasMes = salidas.filter(salida => {
                    try {
                        const fechaSalida = new Date(salida.fecha);
                        return fechaSalida >= primerDiaMes;
                    } catch (e) {
                        return false;
                    }
                }).length;
                
                totalSalidasMesElement.textContent = salidasMes;
            }
            
            // Valor de pérdidas
            const valorPerdidasElement = document.getElementById('valorPerdidas');
            if (valorPerdidasElement) {
                let valorPerdidas = 0;
                
                // Sumar el costo de las salidas por daño
                salidas.forEach(salida => {
                    if (salida.motivo === 'dano') {
                        const producto = productos.find(p => p.id == salida.productoId);
                        if (producto) {
                            valorPerdidas += salida.cantidad * producto.precio_compra;
                        }
                    }
                });
                
                valorPerdidasElement.textContent = formatearMoneda(valorPerdidas);
            }
            
            // Producto más salido
            const productoMasVendidoElement = document.getElementById('productoMasVendido');
            if (productoMasVendidoElement) {
                // Contar salidas por producto
                const salidasPorProducto = {};
                
                salidas.forEach(salida => {
                    if (!salidasPorProducto[salida.productoId]) {
                        salidasPorProducto[salida.productoId] = 0;
                    }
                    salidasPorProducto[salida.productoId] += salida.cantidad;
                });
                
                // Encontrar el producto con más salidas
                let productoMasVendidoId = null;
                let maxSalidas = 0;
                
                for (const productoId in salidasPorProducto) {
                    if (salidasPorProducto[productoId] > maxSalidas) {
                        maxSalidas = salidasPorProducto[productoId];
                        productoMasVendidoId = productoId;
                    }
                }
                
                if (productoMasVendidoId) {
                    const producto = productos.find(p => p.id == productoMasVendidoId);
                    productoMasVendidoElement.textContent = producto ? producto.nombre.substring(0, 10) + (producto.nombre.length > 10 ? '...' : '') : '-';
                } else {
                    productoMasVendidoElement.textContent = '-';
                }
            }
            
            // Promedio diario de salidas
            const promedioDiarioElement = document.getElementById('promedioDiario');
            if (promedioDiarioElement) {
                // Calcular días desde la primera salida hasta hoy
                if (salidas.length > 0) {
                    const fechasSalidas = salidas.map(s => new Date(s.fecha));
                    const fechaMinima = new Date(Math.min(...fechasSalidas));
                    const hoy = new Date();
                    
                    const diferenciaTiempo = hoy - fechaMinima;
                    const diferenciaDias = Math.ceil(diferenciaTiempo / (1000 * 60 * 60 * 24));
                    
                    const promedio = diferenciaDias > 0 ? (salidas.length / diferenciaDias).toFixed(1) : salidas.length;
                    promedioDiarioElement.textContent = promedio;
                } else {
                    promedioDiarioElement.textContent = '0';
                }
            }
        }
        
        // Cambiar página
        function changePage(direction) {
            const totalPages = Math.ceil(filteredProductos.length / itemsPerPage);
            const newPage = currentPage + direction;
            
            if (newPage >= 1 && newPage <= totalPages) {
                currentPage = newPage;
                renderProductos();
            }
        }
        
        // Cambiar de pestaña
        function switchTab(tabName) {
            // Actualizar tabs activos
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Activar tab seleccionado
            event.target.classList.add('active');
            
            // Ocultar todos los contenidos
            document.getElementById('inventarioTab').style.display = 'none';
            document.getElementById('historialTab').style.display = 'none';
            document.getElementById('reportesTab').style.display = 'none';
            
            // Mostrar contenido seleccionado
            document.getElementById(tabName + 'Tab').style.display = 'block';
            
            // Actualizar variable de tab actual
            currentTab = tabName;
            
            // Si es la pestaña de historial, cargar historial
            if (tabName === 'historial') {
                filtrarHistorial();
                cargarFiltroProductos();
            }
            
            // Si es la pestaña de reportes, actualizar gráficos
            if (tabName === 'reportes') {
                generarGraficoReportes();
                actualizarEstadisticasReportes();
            }
        }
        
        // Cargar productos en el filtro del historial
        function cargarFiltroProductos() {
            const historialProductoFilter = document.getElementById('historialProductoFilter');
            if (!historialProductoFilter) return;
            
            // Limpiar opciones actuales excepto la primera
            while (historialProductoFilter.options.length > 1) {
                historialProductoFilter.remove(1);
            }
            
            // Agregar productos (excluyendo bebidas)
            productos.forEach(producto => {
                if (producto.categoria !== 'bebida') {
                    const option = document.createElement('option');
                    option.value = producto.id;
                    option.textContent = producto.nombre;
                    historialProductoFilter.appendChild(option);
                }
            });
        }
        
        // Filtrar y mostrar historial
        function filtrarHistorial() {
            const historialBody = document.getElementById('historialBody');
            if (!historialBody) return;
            
            const productoId = document.getElementById('historialProductoFilter').value;
            const motivo = document.getElementById('historialMotivoFilter').value;
            const periodo = document.getElementById('historialFechaFilter').value;
            
            let historialFiltrado = [...salidas];
            
            // Filtrar por producto
            if (productoId) {
                historialFiltrado = historialFiltrado.filter(salida => salida.productoId == productoId);
            }
            
            // Filtrar por motivo
            if (motivo) {
                historialFiltrado = historialFiltrado.filter(salida => salida.motivo === motivo);
            }
            
            // Filtrar por fecha
            if (periodo) {
                const hoy = new Date();
                hoy.setHours(0, 0, 0, 0);
                
                switch(periodo) {
                    case 'hoy':
                        historialFiltrado = historialFiltrado.filter(salida => {
                            try {
                                const fechaSalida = new Date(salida.fecha);
                                fechaSalida.setHours(0, 0, 0, 0);
                                return fechaSalida.getTime() === hoy.getTime();
                            } catch (e) {
                                return false;
                            }
                        });
                        break;
                    case 'ayer':
                        const ayer = new Date(hoy);
                        ayer.setDate(ayer.getDate() - 1);
                        
                        historialFiltrado = historialFiltrado.filter(salida => {
                            try {
                                const fechaSalida = new Date(salida.fecha);
                                fechaSalida.setHours(0, 0, 0, 0);
                                return fechaSalida.getTime() === ayer.getTime();
                            } catch (e) {
                                return false;
                            }
                        });
                        break;
                    case 'semana':
                        const semanaPasada = new Date(hoy);
                        semanaPasada.setDate(semanaPasada.getDate() - 7);
                        
                        historialFiltrado = historialFiltrado.filter(salida => {
                            try {
                                const fechaSalida = new Date(salida.fecha);
                                return fechaSalida >= semanaPasada;
                            } catch (e) {
                                return false;
                            }
                        });
                        break;
                    case 'mes':
                        const mesPasado = new Date(hoy);
                        mesPasado.setMonth(mesPasado.getMonth() - 1);
                        
                        historialFiltrado = historialFiltrado.filter(salida => {
                            try {
                                const fechaSalida = new Date(salida.fecha);
                                return fechaSalida >= mesPasado;
                            } catch (e) {
                                return false;
                            }
                        });
                        break;
                    case 'personalizado':
                        const fechaDesde = document.getElementById('fechaDesde').value;
                        const fechaHasta = document.getElementById('fechaHasta').value;
                        
                        if (fechaDesde && fechaHasta) {
                            const desde = new Date(fechaDesde);
                            const hasta = new Date(fechaHasta);
                            hasta.setHours(23, 59, 59, 999); // Incluir todo el día
                            
                            historialFiltrado = historialFiltrado.filter(salida => {
                                try {
                                    const fechaSalida = new Date(salida.fecha);
                                    return fechaSalida >= desde && fechaSalida <= hasta;
                                } catch (e) {
                                    return false;
                                }
                            });
                        }
                        break;
                }
            }
            
            // Ordenar por fecha más reciente primero
            historialFiltrado.sort((a, b) => {
                try {
                    const fechaA = new Date(a.fecha);
                    const fechaB = new Date(b.fecha);
                    return fechaB - fechaA;
                } catch (e) {
                    return 0;
                }
            });
            
            // Mostrar estado vacío si no hay historial
            if (historialFiltrado.length === 0) {
                historialBody.innerHTML = `
                    <tr class="empty-state">
                        <td colspan="7">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                            </svg>
                            <h3>No hay registro de salidas</h3>
                            <p>${salidas.length === 0 ? 'Registra la primera salida de productos' : 'Intenta con otros filtros de búsqueda'}</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Renderizar historial
            let htmlContent = '';
            
            for (let i = 0; i < historialFiltrado.length; i++) {
                const salida = historialFiltrado[i];
                
                // Formatear fecha
                let fechaFormateada = '';
                try {
                    const fecha = new Date(salida.fecha);
                    fechaFormateada = fecha.toLocaleDateString('es-ES', {
                        day: '2-digit',
                        month: '2-digit',
                        year: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                } catch (e) {
                    fechaFormateada = 'Fecha no válida';
                }
                
                // Obtener nombre del producto
                const producto = productos.find(p => p.id == salida.productoId);
                const nombreProducto = producto ? producto.nombre : 'Producto no encontrado';
                
                htmlContent += `
                    <tr>
                        <td>${fechaFormateada}</td>
                        <td><strong>${nombreProducto}</strong></td>
                        <td>${salida.cantidad} ${getUnidadMedida(producto ? producto.categoria : 'otro')}</td>
                        <td>
                            <span class="motivo-badge motivo-${salida.motivo}">
                                ${getMotivoLabel(salida.motivo)}
                            </span>
                        </td>
                        <td>${salida.responsable}</td>
                        <td>${salida.observaciones || '-'}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn-icon btn-eliminar" onclick="eliminarSalida('${salida.id}')" title="Eliminar registro">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }
            
            historialBody.innerHTML = htmlContent;
        }
        
        // Generar gráfico para reportes
        function generarGraficoReportes() {
            const graficoBarras = document.getElementById('graficoBarras');
            if (!graficoBarras) return;
            
            // Agrupar salidas por producto
            const salidasPorProducto = {};
            
            salidas.forEach(salida => {
                if (!salidasPorProducto[salida.productoId]) {
                    salidasPorProducto[salida.productoId] = 0;
                }
                salidasPorProducto[salida.productoId] += salida.cantidad;
            });
            
            // Obtener nombres de productos
            const productosConSalidas = [];
            for (const productoId in salidasPorProducto) {
                const producto = productos.find(p => p.id == productoId);
                if (producto) {
                    productosConSalidas.push({
                        nombre: producto.nombre,
                        cantidad: salidasPorProducto[productoId]
                    });
                }
            }
            
            // Ordenar por cantidad de salidas
            productosConSalidas.sort((a, b) => b.cantidad - a.cantidad).slice(0, 5);
            
            // Limpiar gráfico anterior
            graficoBarras.innerHTML = '';
            
            // Calcular máxima altura para normalizar
            const maxCantidad = productosConSalidas.length > 0 ? 
                Math.max(...productosConSalidas.map(p => p.cantidad)) : 0;
            
            // Generar barras del gráfico
            productosConSalidas.forEach(producto => {
                const altura = maxCantidad > 0 ? (producto.cantidad / maxCantidad * 250) : 0;
                
                const barra = document.createElement('div');
                barra.style.cssText = `
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    width: 60px;
                `;
                
                barra.innerHTML = `
                    <div style="
                        height: ${altura}px;
                        width: 40px;
                        background: linear-gradient(to top, #ff7e5f, #feb47b);
                        border-radius: 8px 8px 0 0;
                        margin-bottom: 10px;
                        display: flex;
                        align-items: flex-end;
                        justify-content: center;
                        color: white;
                        font-weight: bold;
                        padding: 5px;
                        font-size: 12px;
                    ">${producto.cantidad.toFixed(1)}</div>
                    <div style="
                        font-size: 11px;
                        color: #4a5568;
                        text-align: center;
                        height: 40px;
                        overflow: hidden;
                        font-weight: 600;
                    ">${producto.nombre.substring(0, 10)}${producto.nombre.length > 10 ? '...' : ''}</div>
                `;
                
                graficoBarras.appendChild(barra);
            });
            
            // Actualizar resumen de actividad
            actualizarResumenActividad();
        }
        
        // Actualizar resumen de actividad
        function actualizarResumenActividad() {
            const resumenActividad = document.getElementById('resumenActividad');
            if (!resumenActividad) return;
            
            const hoy = new Date();
            const ayer = new Date(hoy);
            ayer.setDate(ayer.getDate() - 1);
            
            // Calcular estadísticas
            const salidasHoy = salidas.filter(salida => {
                try {
                    const fechaSalida = new Date(salida.fecha);
                    fechaSalida.setHours(0, 0, 0, 0);
                    const hoySinHora = new Date(hoy);
                    hoySinHora.setHours(0, 0, 0, 0);
                    return fechaSalida.getTime() === hoySinHora.getTime();
                } catch (e) {
                    return false;
                }
            }).length;
            
            const salidasAyer = salidas.filter(salida => {
                try {
                    const fechaSalida = new Date(salida.fecha);
                    fechaSalida.setHours(0, 0, 0, 0);
                    const ayerSinHora = new Date(ayer);
                    ayerSinHora.setHours(0, 0, 0, 0);
                    return fechaSalida.getTime() === ayerSinHora.getTime();
                } catch (e) {
                    return false;
                }
            }).length;
            
            const productosBajos = productos.filter(p => 
                p.categoria !== 'bebida' && 
                p.cantidad <= p.stockMinimo && 
                p.cantidad > 0
            ).length;
            
            const productosAgotados = productos.filter(p => 
                p.categoria !== 'bebida' && 
                p.cantidad === 0
            ).length;
            
            // Calcular diferencia porcentual con ayer
            const diferencia = salidasAyer > 0 ? 
                Math.round(((salidasHoy - salidasAyer) / salidasAyer) * 100) : 
                (salidasHoy > 0 ? 100 : 0);
            
            const tendencia = diferencia >= 0 ? '<i class="fas fa-arrow-up"></i>' : '<i class="fas fa-arrow-down"></i>';
            const claseTendencia = diferencia >= 0 ? 'color: #38a169;' : 'color: #e53e3e;';
            
            resumenActividad.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem;">
                    <div>
                        <div style="font-weight: 600; color: #4a5568; margin-bottom: 0.5rem;">Salidas Hoy</div>
                        <div style="font-size: 1.5rem; font-weight: 700; color: #ff7e5f;">${salidasHoy}</div>
                        <div style="font-size: 0.85rem; margin-top: 0.25rem;">
                            ${tendencia} <span style="${claseTendencia}">${Math.abs(diferencia)}%</span> vs ayer
                        </div>
                    </div>
                    <div>
                        <div style="font-weight: 600; color: #4a5568; margin-bottom: 0.5rem;">Productos con Stock Bajo</div>
                        <div style="font-size: 1.5rem; font-weight: 700; color: #d69e2e;">${productosBajos}</div>
                        <div style="font-size: 0.85rem; margin-top: 0.25rem; color: #718096;">
                            Requieren atención
                        </div>
                    </div>
                    <div>
                        <div style="font-weight: 600; color: #4a5568; margin-bottom: 0.5rem;">Productos Agotados</div>
                        <div style="font-size: 1.5rem; font-weight: 700; color: #e53e3e;">${productosAgotados}</div>
                        <div style="font-size: 0.85rem; margin-top: 0.25rem; color: #718096;">
                            Necesitan reabastecimiento urgente
                        </div>
                    </div>
                    <div>
                        <div style="font-weight: 600; color: #4a5568; margin-bottom: 0.5rem;">Salidas Totales</div>
                        <div style="font-size: 1.5rem; font-weight: 700; color: #9c27b0;">${salidas.length}</div>
                        <div style="font-size: 0.85rem; margin-top: 0.25rem; color: #718096;">
                            Registros en el sistema
                        </div>
                    </div>
                </div>
            `;
        }
        
        // Abrir modal para registrar salida
        async function registrarSalidaModal(productoId) {
            // Primero actualizamos los datos desde la base de datos
            await cargarProductosDesdeDjango();
            
            const producto = productos.find(p => p.id == productoId);
            if (!producto) {
                mostrarNotificacion('Producto no encontrado', 'error');
                return;
            }
            
            // Verificar que no sea bebida
            if (producto.categoria === 'bebida') {
                mostrarNotificacion('No se puede registrar salida de bebidas', 'error');
                return;
            }
            
            // Llenar datos en el modal
            document.getElementById('productoId').value = productoId;
            document.getElementById('productoNombre').value = producto.nombre;
            document.getElementById('stockActual').value = `${formatearNumero(producto.cantidad)} ${getUnidadMedida(producto.categoria)}`;
            
            // Establecer valor máximo en el input
            const cantidadInput = document.getElementById('cantidadSalida');
            cantidadInput.max = producto.cantidad;
            cantidadInput.value = producto.cantidad > 0 ? formatearNumero(1.00) : '0';
            
            // Mostrar modal
            document.getElementById('salidaModal').classList.add('active');
        }
        
        // Registrar salida - LLAMADA AJAX AL SERVIDOR
        async function registrarSalida() {
            const productoId = document.getElementById('productoId').value;
            const cantidadInput = document.getElementById('cantidadSalida').value.replace(/,/g, '');
            const cantidad = parseFloat(cantidadInput);
            const motivo = document.getElementById('motivoSalida').value;
            const responsable = document.getElementById('responsableSalida').value;
            const observaciones = document.getElementById('observacionesSalida').value;
            
            if (!productoId || !cantidad || cantidad <= 0) {
                mostrarNotificacion('Ingresa una cantidad válida', 'error');
                return;
            }
            
            // Deshabilitar botón mientras se procesa
            const btn = document.getElementById('registrarSalidaBtn');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<span><i class="fas fa-spinner fa-spin"></i></span><span>Procesando...</span>';
            btn.disabled = true;
            
            try {
                // Enviar solicitud al servidor para registrar la salida
                const response = await fetch('/registrar-salida/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCookie('csrftoken')
                    },
                    body: JSON.stringify({
                        producto_id: productoId,
                        cantidad: cantidad,
                        motivo: motivo,
                        responsable: responsable,
                        observaciones: observaciones
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // Actualizar producto localmente
                    const productoIndex = productos.findIndex(p => p.id == productoId);
                    if (productoIndex !== -1) {
                        productos[productoIndex].cantidad = data.nueva_cantidad;
                        productos[productoIndex].ultimaSalida = new Date().toISOString();
                    }
                    
                    // Crear registro de salida para el historial
                    const producto = productos.find(p => p.id == productoId);
                    const nuevaSalida = {
                        id: salidas.length > 0 ? Math.max(...salidas.map(s => s.id)) + 1 : 1,
                        productoId: productoId,
                        cantidad: cantidad,
                        motivo: motivo,
                        responsable: responsable,
                        observaciones: observaciones,
                        fecha: new Date().toISOString()
                    };
                    
                    salidas.push(nuevaSalida);
                    guardarHistorialEnStorage();
                    
                    // Actualizar filteredProductos
                    const filteredIndex = filteredProductos.findIndex(p => p.id == productoId);
                    if (filteredIndex !== -1) {
                        filteredProductos[filteredIndex].cantidad = data.nueva_cantidad;
                        filteredProductos[filteredIndex].ultimaSalida = new Date().toISOString();
                    }
                    
                    // Actualizar interfaz
                    renderProductos();
                    actualizarEstadisticas();
                    
                    // Cerrar modal
                    closeModal();
                    mostrarNotificacion(data.message, 'success');
                    
                    // Si estamos en la pestaña de historial, actualizar
                    if (currentTab === 'historial') {
                        filtrarHistorial();
                    }
                    
                    // Si estamos en la pestaña de reportes, actualizar gráficos
                    if (currentTab === 'reportes') {
                        generarGraficoReportes();
                        actualizarEstadisticasReportes();
                    }
                } else {
                    mostrarNotificacion(data.error || 'Error al registrar salida', 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                mostrarNotificacion('Error de conexión', 'error');
            } finally {
                // Restaurar botón
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }
        
        // Abrir modal para reabastecer stock
        async function reabastecerModal(productoId) {
            // Primero actualizamos los datos desde la base de datos
            await cargarProductosDesdeDjango();
            
            const producto = productos.find(p => p.id == productoId);
            if (!producto) {
                mostrarNotificacion('Producto no encontrado', 'error');
                return;
            }
            
            // Llenar datos en el modal
            document.getElementById('reabastecerProductoId').value = productoId;
            document.getElementById('reabastecerNombre').value = producto.nombre;
            document.getElementById('reabastecerStockActual').value = `${formatearNumero(producto.cantidad)} ${getUnidadMedida(producto.categoria)}`;
            
            // Mostrar modal
            document.getElementById('reabastecerModal').classList.add('active');
        }
        
        // Confirmar reabastecimiento - LLAMADA AJAX AL SERVIDOR
        async function confirmarReabastecimiento() {
            const productoId = document.getElementById('reabastecerProductoId').value;
            const cantidadInput = document.getElementById('cantidadReabastecer').value.replace(/,/g, '');
            const cantidad = parseFloat(cantidadInput);
            const motivo = document.getElementById('motivoReabastecer').value;
            const observaciones = document.getElementById('observacionesReabastecer').value;
            
            if (!productoId || !cantidad || cantidad <= 0) {
                mostrarNotificacion('Ingresa una cantidad válida', 'error');
                return;
            }
            
            try {
                // Enviar solicitud al servidor para reabastecer
                const response = await fetch('/reabastecer-producto/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCookie('csrftoken')
                    },
                    body: JSON.stringify({
                        producto_id: productoId,
                        cantidad: cantidad,
                        motivo: motivo,
                        observaciones: observaciones
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // Actualizar producto localmente
                    const productoIndex = productos.findIndex(p => p.id == productoId);
                    if (productoIndex !== -1) {
                        productos[productoIndex].cantidad = data.nueva_cantidad;
                    }
                    
                    // Crear registro de reabastecimiento para el historial
                    const producto = productos.find(p => p.id == productoId);
                    const reabastecimiento = {
                        id: salidas.length > 0 ? Math.max(...salidas.map(s => s.id)) + 1 : 1,
                        productoId: productoId,
                        cantidad: cantidad,
                        motivo: 'reabastecimiento',
                        responsable: 'Administrador',
                        observaciones: `Reabastecimiento: ${motivo} - ${observaciones || 'Sin observaciones'}`,
                        fecha: new Date().toISOString()
                    };
                    
                    salidas.push(reabastecimiento);
                    guardarHistorialEnStorage();
                    
                    // Actualizar filteredProductos
                    const filteredIndex = filteredProductos.findIndex(p => p.id == productoId);
                    if (filteredIndex !== -1) {
                        filteredProductos[filteredIndex].cantidad = data.nueva_cantidad;
                    }
                    
                    // Actualizar interfaz
                    renderProductos();
                    actualizarEstadisticas();
                    
                    // Cerrar modal
                    closeReabastecerModal();
                    mostrarNotificacion(data.message, 'success');
                    
                    // Si estamos en la pestaña de historial, actualizar
                    if (currentTab === 'historial') {
                        filtrarHistorial();
                    }
                    
                    // Si estamos en la pestaña de reportes, actualizar gráficos
                    if (currentTab === 'reportes') {
                        generarGraficoReportes();
                        actualizarEstadisticasReportes();
                    }
                } else {
                    mostrarNotificacion(data.error || 'Error al reabastecer', 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                mostrarNotificacion('Error de conexión', 'error');
            }
        }
        
        // Eliminar registro de salida
        function eliminarSalida(salidaId) {
            if (!confirm('¿Estás seguro de eliminar este registro de salida? Esta acción no se puede deshacer.')) {
                return;
            }
            
            const index = salidas.findIndex(s => s.id == salidaId);
            if (index === -1) {
                mostrarNotificacion('Registro no encontrado', 'error');
                return;
            }
            
            // Recuperar el stock (solo si fue una salida, no reabastecimiento)
            const salida = salidas[index];
            if (salida.motivo !== 'reabastecimiento') {
                // En un sistema real, aquí deberías hacer una petición al servidor para revertir la salida
                // Por ahora, solo eliminamos el registro del historial local
                console.log('Nota: Para revertir el stock, se necesita una petición al servidor');
            }
            
            salidas.splice(index, 1);
            guardarHistorialEnStorage();
            
            // Actualizar interfaz
            actualizarEstadisticas();
            
            if (currentTab === 'historial') {
                filtrarHistorial();
            }
            
            if (currentTab === 'reportes') {
                generarGraficoReportes();
                actualizarEstadisticasReportes();
            }
            
            mostrarNotificacion('<i class="fas fa-check-circle"></i> Registro de salida eliminado correctamente', 'success');
        }
        
        // Funciones de exportación
        function exportReport() {
            mostrarNotificacion('Generando reporte de inventario...', 'info');
            // En un sistema real, aquí se generaría y descargaría un archivo
            setTimeout(() => {
                mostrarNotificacion('<i class="fas fa-check-circle"></i> Reporte de inventario exportado correctamente', 'success');
            }, 1000);
        }
        
        function exportHistorial() {
            mostrarNotificacion('Generando historial de salidas...', 'info');
            // En un sistema real, aquí se generaría y descargaría un archivo
            setTimeout(() => {
                mostrarNotificacion('<i class="fas fa-check-circle"></i> Historial de salidas exportado correctamente', 'success');
            }, 1000);
        }
        
        function exportReporteCompleto() {
            mostrarNotificacion('Generando reporte completo...', 'info');
            // En un sistema real, aquí se generaría y descargaría un archivo
            setTimeout(() => {
                mostrarNotificacion('<i class="fas fa-check-circle"></i> Reporte completo exportado correctamente', 'success');
            }, 1000);
        }
        
        function generarReporteMensual() {
            mostrarNotificacion('Generando reporte mensual...', 'info');
            // En un sistema real, aquí se generaría y descargaría un archivo
            setTimeout(() => {
                mostrarNotificacion('<i class="fas fa-check-circle"></i> Reporte mensual generado correctamente', 'success');
            }, 1000);
        }
        
        // Helper functions
        function getCategoriaLabel(categoria) {
            const labels = {
                'carne': 'Carne',
                'verdura': 'Verdura',
                'lacteo': 'Lácteo',
                'postre': 'Postre',
                'bebida': 'Bebida',
                'otro': 'Otro'
            };
            return labels[categoria] || categoria || 'Desconocida';
        }
        
        function getCategoriaIcon(categoria) {
            const icons = {
                'carne': '<i class="fas fa-drumstick-bite"></i>',
                'verdura': '<i class="fas fa-leaf"></i>',
                'lacteo': '<i class="fas fa-glass-whiskey"></i>',
                'postre': '<i class="fas fa-birthday-cake"></i>',
                'bebida': '<i class="fas fa-glass-martini"></i>',
                'otro': '<i class="fas fa-box"></i>'
            };
            return icons[categoria] || '<i class="fas fa-box"></i>';
        }
        
        function getUnidadMedida(categoria) {
            // Puedes personalizar las unidades de medida según la categoría
            const unidades = {
                'carne': 'kg',
                'verdura': 'kg',
                'lacteo': 'lt',
                'postre': 'unid',
                'bebida': 'lt',
                'otro': 'unid'
            };
            return unidades[categoria] || 'unid';
        }
        
        function getMotivoLabel(motivo) {
            const labels = {
                'venta': 'Venta',
                'dano': 'Daño',
                'ajuste': 'Ajuste',
                'consumo': 'Consumo Interno',
                'reabastecimiento': 'Reabastecimiento',
                'otro': 'Otro'
            };
            return labels[motivo] || motivo || 'Desconocido';
        }
        
        // Función para obtener el token CSRF
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
        
        // Cerrar modales
        function closeModal() {
            document.getElementById('salidaModal').classList.remove('active');
        }
        
        function closeReabastecerModal() {
            document.getElementById('reabastecerModal').classList.remove('active');
        }
        
        // Mostrar notificación
        function mostrarNotificacion(message, type = 'success') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'error' ? 'linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%)' : 
                             type === 'warning' ? 'linear-gradient(135deg, #ffb347 0%, #ffcc33 100%)' :
                             type === 'info' ? 'linear-gradient(135deg, #2196F3 0%, #21CBF3 100%)' :
                             'linear-gradient(135deg, #ff7e5f 0%, #feb47b 100%)'};
                color: white;
                padding: 1rem 1.5rem;
                border-radius: 12px;
                box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
                z-index: 1000;
                animation: slideIn 0.3s ease-out;
                font-weight: 600;
                display: flex;
                align-items: center;
                gap: 10px;
            `;
            
            notification.innerHTML = message;
            document.body.appendChild(notification);
            
            // Remover después de 5 segundos
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease-out';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 5000);
        }
        
        // Sidebar toggle
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            sidebar.classList.toggle('open');
            overlay.classList.toggle('open');
        }
        
        // Añadir animación CSS para notificaciones
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
        
        // Inicializar cuando se carga la página
        window.addEventListener('load', function() {
            // Establecer fechas por defecto para el filtro personalizado
            const hoy = new Date();
            const hace7Dias = new Date(hoy);
            hace7Dias.setDate(hace7Dias.getDate() - 7);
            
            const fechaDesde = document.getElementById('fechaDesde');
            const fechaHasta = document.getElementById('fechaHasta');
            
            if (fechaDesde) {
                fechaDesde.value = hace7Dias.toISOString().split('T')[0];
            }
            
            if (fechaHasta) {
                fechaHasta.value = hoy.toISOString().split('T')[0];
            }
        });
    </script>
</body>
</html>